<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Create a keyboard interface to the web · alexherbo2</title>
  
    <meta name="description" content="A keyboard interface to the web, inspired by Kakoune">
  
  
  
    <link href="https://github.com/favicon.ico" rel="icon">
  
  
  
    <link href="/css/main.css" rel="stylesheet">
  
    <link href="/packages/selection.css" rel="stylesheet">
  
    <link href="/packages/krabby.css" rel="stylesheet">
  
  
  
    <script src="/js/main.js"></script>
  
    <script src="/packages/modal.js"></script>
  
    <script src="/packages/mouse-selection.js"></script>
  
    <script src="/packages/prompt.js"></script>
  
    <script src="/packages/hint.js"></script>
  
    <script src="/packages/mark.js"></script>
  
    <script src="/packages/selection.js"></script>
  
    <script src="/packages/mouse.js"></script>
  
    <script src="/packages/clipboard.js"></script>
  
    <script src="/packages/scroll.js"></script>
  
    <script src="/packages/player.js"></script>
  
    <script src="/packages/krabby.js"></script>
  
    <script src="/config.js"></script>
  
  
  <script src="https://kit.fontawesome.com/b030fd7e2d.js" crossorigin="anonymous"></script>
  
  <script src="https://momentjs.com/downloads/moment.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" rel="stylesheet">
</head>

  <body>
    <div id="header">
      <header>
  <a href="/">alexherbo2</a>
</header>

      <nav>
  <ul>
    
      <li>
        <a href="/blog">Blog</a>
      </li>
    
      <li>
        <a href="/citations">Citations</a>
      </li>
    
      <li>
        <a href="/config">Config</a>
      </li>
    
      <li>
        <a href="/projects">Projects</a>
      </li>
    
      <li>
        <a href="/wiki">Wiki</a>
      </li>
    
  </ul>
</nav>

    </div>
    <hr class="top">
    <main>
      
  
  
  <div id="heading">
    <div class="wrap">
      <h1><a href="https://alexherbo2.github.io/blog/chrome/create-a-keyboard-interface-to-the-web/">Create a keyboard interface to the web</a></h1>
      <ul class="icons">
        
        
          <li>
            <a title="Raw" href="https://github.com/alexherbo2/website/raw/master/content/blog/chrome/create-a-keyboard-interface-to-the-web.md"><i class="far fa-file"></i></a>
          </li>
        
        
          <li>
            <a title="September 19, 2020" href="https://github.com/alexherbo2/website/commits/master/content/blog/chrome/create-a-keyboard-interface-to-the-web.md"><i class="fab fa-git-square"></i></a>
          </li>
        
        
          <li>
            <a title="Suggest an edit" href="https://github.com/alexherbo2/website/edit/master/content/blog/chrome/create-a-keyboard-interface-to-the-web.md"><i class="fas fa-pen-square"></i></a>
          </li>
        
      </ul>
    </div>
    
      <div class="date">
        
          <p>Posted on <time class="relative" datetime="2019-03-05 00:00:00 &#43;0000 UTC">March 5, 2019</time> (↻ <time class="relative" datetime="September 19, 2020">September 19, 2020</time>).</p>
        
      </div>
    
  </div>
  <div class="invisible">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#demos">Demos</a></li>
    <li><a href="#try-it">Try It</a></li>
    <li><a href="#getting-started">Getting Started</a></li>
    <li><a href="#part-1-modal">Part 1: Modal</a>
      <ul>
        <li><a href="#the-console">The Console</a></li>
        <li><a href="#the-content-script">The Content Script</a></li>
        <li><a href="#the-library">The Library</a></li>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#filters">Filters</a></li>
        <li><a href="#mappings">Mappings</a></li>
        <li><a href="#events-1">Events</a></li>
        <li><a href="#key-values">Key values</a></li>
        <li><a href="#help">Help</a></li>
        <li><a href="#notifications">Notifications</a></li>
        <li><a href="#configuration">Configuration</a></li>
        <li><a href="#more-commands">More commands</a></li>
        <li><a href="#updates">Updates</a></li>
      </ul>
    </li>
    <li><a href="#part-2-link-hints">Part 2: Link Hints</a>
      <ul>
        <li><a href="#the-prototype">The Prototype</a></li>
        <li><a href="#filtering">Filtering</a></li>
        <li><a href="#rendering">Rendering</a></li>
        <li><a href="#updating">Updating</a></li>
        <li><a href="#input-handler">Input handler</a></li>
        <li><a href="#updates-1">Updates</a></li>
      </ul>
    </li>
    <li><a href="#part-3-toolbox">Part 3: Toolbox</a>
      <ul>
        <li><a href="#mouse">Mouse</a></li>
        <li><a href="#clipboard">Clipboard</a></li>
        <li><a href="#scroll-1">Scroll</a></li>
        <li><a href="#player">Player</a></li>
      </ul>
    </li>
    <li><a href="#part-4-multiple-selections">Part 4: Multiple selections</a>
      <ul>
        <li><a href="#overview-1">Overview</a></li>
        <li><a href="#the-prototype-1">The Prototype</a></li>
        <li><a href="#implementation">Implementation</a></li>
        <li><a href="#configuration-1">Configuration</a></li>
      </ul>
    </li>
    <li><a href="#part-5-polishment">Part 5: Polishment</a>
      <ul>
        <li><a href="#custom-prompt">Custom prompt</a></li>
        <li><a href="#icons">Icons</a></li>
      </ul>
    </li>
    <li><a href="#part-6-chrome-apis">Part 6: Chrome APIs</a>
      <ul>
        <li><a href="#new-extension">New extension</a></li>
        <li><a href="#commands">Commands</a></li>
        <li><a href="#initialization">Initialization</a></li>
        <li><a href="#configuration-2">Configuration</a></li>
      </ul>
    </li>
    <li><a href="#part-7-native-messaging-and-external-commands">Part 7: Native messaging and external commands</a>
      <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#native-messaging-host">Native messaging host</a></li>
        <li><a href="#native-messaging-host-location">Native messaging host location</a></li>
        <li><a href="#native-messaging-protocol">Native messaging protocol</a></li>
        <li><a href="#meet-crystal">Meet Crystal</a></li>
        <li><a href="#connecting-to-the-application">Connecting to the application</a></li>
        <li><a href="#configuration-3">Configuration</a></li>
      </ul>
    </li>
    <li><a href="#part-8-tab-search">Part 8: Tab search</a></li>
    <li><a href="#part-9-publish-your-extension">Part 9: Publish your extension</a></li>
    <li><a href="#bonus">Bonus</a>
      <ul>
        <li><a href="#unfocus-omnibox">Unfocus Omnibox</a></li>
        <li><a href="#create-a-theme-for-chrome">Create a theme for Chrome</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
  <div id="context-navigation">
    <a><i class="fas fa-angle-up"></i></a>
  </div>
  <p><strong>PostEdit</strong>:</p>
<p>The roadmap to create a vi-like browser extension from scratch,
from experimenting things in the console to <a href="https://developer.chrome.com/extensions/nativeMessaging">native</a> and <a href="https://developer.chrome.com/extensions/messaging#external">cross-extension</a> messaging.
The first version of <a href="https://krabby.netlify.app">Krabby</a> 🦀.</p>
<hr>
<p>This post is written for <a href="https://google.com/chrome/">Chrome</a>, but can be adapted to the browser of your liking.</p>
<ul>
<li><a href="https://github.com/alexherbo2/chrome-configuration">Configuration</a> and <a href="https://support.google.com/chrome/answer/157179">default shortcuts</a> for <a href="https://google.com/chrome/">Chrome</a></li>
<li><a href="https://github.com/alexherbo2/firefox-configuration">Configuration</a> and <a href="https://support.mozilla.org/en-US/kb/keyboard-shortcuts-perform-firefox-tasks-quickly">default shortcuts</a> for <a href="https://mozilla.org/firefox/">Firefox</a></li>
<li><a href="https://github.com/alexherbo2/surf-configuration">Configuration</a> and <a href="https://git.suckless.org/surf/file/config.def.h.html">default shortcuts</a> for <a href="https://surf.suckless.org">surf</a></li>
</ul>
<h2 id="demos">Demos</h2>
<p><a href="https://youtube.com/playlist?list=PLdr-HcjEDx_kOnqvLcE5T1tq9rAVwmths">Krabby</a></p>
<h2 id="try-it">Try It</h2>
<ul>
<li>Make sure to deactivate your extension and browser bindings.</li>
<li>Press <code>Alt</code> + <code>Escape</code> to activate <a href="/packages/krabby.js">Krabby</a>.</li>
<li>Press <code>F1</code> for help.</li>
</ul>
<p><strong>Note</strong>: Commands are bound to <strong>physical keys</strong> and <strong>displayed</strong> with the <a href="https://en.wikipedia.org/wiki/QWERTY">US layout</a>.</p>
<script>
  DOMContentLoaded = (event) => {
    const tableOfContents = document.querySelector('#TableOfContents')
    if (tableOfContents) {
      const node = document.querySelector('#table-of-contents')
      node.replaceWith(tableOfContents)
    }
    const content = document.querySelector('main')
    const headings = content.querySelectorAll('h1[id], h2[id], h3[id], h4[id]')
    for (const heading of headings) {
      if (tableOfContents.compareDocumentPosition(heading) === Node.DOCUMENT_POSITION_PRECEDING) {
        const item = tableOfContents.querySelector(`[href="#${heading.id}"]`)
        if (item) {
          item.parentElement.remove()
        }
      }
    }
  }
  document.addEventListener('DOMContentLoaded', DOMContentLoaded)
</script>

<h2>Table of Contents</h2>
<div id="table-of-contents"></div>

<h2 id="getting-started">Getting Started</h2>
<p>To start, create a new directory to hold the extension’s files.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir chrome-configuration
cd chrome-configuration
</code></pre></div><p>Create a <a href="https://developer.chrome.com/extensions/manifest">manifest</a>.</p>
<p><code>manifest.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;manifest_version&#34;</span>: <span style="color:#ae81ff">2</span>,
  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Configuration&#34;</span>,
  <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Configuration for Chrome&#34;</span>,
  <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0.1.0&#34;</span>
}
</code></pre></div><p>The directory holding the manifest can be added as an extension in developer mode in its current state.</p>
<p>Open the <em>Extensions</em> page by navigating to <code>chrome://extensions</code>, enable <em>Developer mode</em> then <em>Load unpacked</em> to select the extension directory.</p>
<p><img src="https://developer.chrome.com/static/images/get_started/load_extension.png" alt="Load extension"></p>
<p>See the <a href="https://developer.chrome.com/extensions/getstarted">Getting Started Tutorial</a> for more information.</p>
<h2 id="part-1-modal">Part 1: Modal</h2>
<p>The completed script can be downloaded <a href="https://github.com/alexherbo2/modal.js">here</a>.</p>
<h3 id="the-console">The Console</h3>
<p>Press <code>Control</code> + <code>J</code> to open the <em>Console</em>, and <em>Paste</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;keydown&#39;</span>, (<span style="color:#a6e22e">event</span>) =&gt; {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;KeyJ&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">altKey</span>)
    document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">60</span> })
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;KeyK&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">altKey</span>)
    document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">60</span> })
})
</code></pre></div><p>You can now scroll down and up with <code>Alt</code> + <code>j</code> and <code>Alt</code> + <code>k</code>.</p>
<p>To map <code>j</code> and <code>k</code> without the <code>Alt</code> prefix,
we need to detect whether the <a href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentOrShadowRoot/activeElement">active element</a> is text.</p>
<p>It’s handled by the following function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">isText</span>(<span style="color:#a6e22e">element</span>) {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nodeNames</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;INPUT&#39;</span>, <span style="color:#e6db74">&#39;TEXTAREA&#39;</span>, <span style="color:#e6db74">&#39;OBJECT&#39;</span>]
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">offsetParent</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">nodeNames</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">nodeName</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">isContentEditable</span>)
}
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;keydown&#39;</span>, (<span style="color:#a6e22e">event</span>) =&gt; {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;KeyJ&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isText</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">false</span>)
    document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">60</span> })
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;KeyK&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isText</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">false</span>)
    document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">60</span> })
})
</code></pre></div><h3 id="the-content-script">The Content Script</h3>
<p>Create a <a href="https://developer.chrome.com/extensions/content_scripts">content script</a> titled <code>config.js</code> with everything preceding.</p>
<p>Update your manifest and reload the extension.</p>
<p><code>manifest.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;content_scripts&#34;</span>: [
    {
      <span style="color:#f92672">&#34;matches&#34;</span>: [
        <span style="color:#e6db74">&#34;&lt;all_urls&gt;&#34;</span>
      ],
      <span style="color:#f92672">&#34;js&#34;</span>: [
        <span style="color:#e6db74">&#34;config.js&#34;</span>
      ]
    }
  ]
}
</code></pre></div><h3 id="the-library">The Library</h3>
<p>Create a script titled under <code>scripts/modal.js</code> and add the following skeleton:</p>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">name</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">name</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filters</span> <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">mappings</span> <span style="color:#f92672">=</span> {}
  }
  <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">filter</span>) {
  }
  <span style="color:#a6e22e">enable</span>(...<span style="color:#a6e22e">filters</span>) {
  }
  <span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">context</span>, <span style="color:#a6e22e">keys</span>, <span style="color:#a6e22e">command</span>, <span style="color:#a6e22e">description</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>) {
  }
  <span style="color:#a6e22e">unmap</span>(<span style="color:#a6e22e">context</span>, <span style="color:#a6e22e">keys</span>) {
  }
  <span style="color:#a6e22e">mode</span>(<span style="color:#a6e22e">nextMode</span>) {
  }
  <span style="color:#a6e22e">on</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">listener</span>) {
  }
  <span style="color:#a6e22e">listen</span>() {
  }
  <span style="color:#a6e22e">unlisten</span>() {
  }
}
</code></pre></div><p>Like <code>config.js</code>, this file needs to be designated as a content script in the manifest.</p>
<p><code>manifest.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;content_scripts&#34;</span>: [
    {
      <span style="color:#f92672">&#34;matches&#34;</span>: [
        <span style="color:#e6db74">&#34;&lt;all_urls&gt;&#34;</span>
      ],
      <span style="color:#f92672">&#34;js&#34;</span>: [
        <span style="color:#e6db74">&#34;scripts/modal.js&#34;</span>,
        <span style="color:#e6db74">&#34;config.js&#34;</span>
      ]
    }
  ]
}
</code></pre></div><h3 id="overview">Overview</h3>
<h4 id="contexts">Contexts</h4>
<p>Modal lets you map a key to a command in different contexts:</p>
<ul>
<li><strong>Command</strong> is the context for entering keyboard commands,</li>
<li><strong>Text</strong> is the context for typing text,</li>
<li><strong>Link</strong> is the context for links,</li>
<li><strong>Video</strong> is the context for videos,</li>
<li><strong>Page</strong> is a context with no filtering.</li>
</ul>
<h4 id="get-started">Get started</h4>
<p><strong>Example</strong> – A minimal configuration for getting started:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">modal</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Modal</span>
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">enable</span>(<span style="color:#e6db74">&#39;Text&#39;</span>, <span style="color:#e6db74">&#39;Command&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyJ&#39;</span>], () =&gt; document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">60</span> }), <span style="color:#e6db74">&#39;Scroll down&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyK&#39;</span>], () =&gt; document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">60</span> }), <span style="color:#e6db74">&#39;Scroll up&#39;</span>)
</code></pre></div><p><strong>Context</strong>: Context of the command.</p>
<p><strong>Keys</strong>: Keys represent a chord – a key sequence in which the keys are pressed at the same time.
They are composed of a single <a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code">key code</a> and optional <a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values#Modifier_keys">modifiers</a>.
For special keys, the list of key values can be found <a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values">here</a>.</p>
<p><strong>Command</strong>: The command is either a function that takes exactly one argument – the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/keydown_event">keydown</a>
event that triggered the command – or an instance of <strong>Modal</strong>.</p>
<p><strong>Description</strong>: Description of the command.</p>
<p><strong>Note</strong>: Commands are bound to physical keys and displayed with the US layout by default.
If you want to display the commands with a different layout, you can set the <code>keyMap</code> or <code>KEY_MAP</code> properties,
depending if you want to change the display for an instance of <strong>Modal</strong> or the class itself.</p>
<h4 id="passing-mode">Passing mode</h4>
<p><strong>Example</strong> – Create a mode to pass all keys but <code>Alt</code> + <code>Escape</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pass</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Modal</span>(<span style="color:#e6db74">&#39;Pass&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Page&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Escape&#39;</span>], <span style="color:#a6e22e">pass</span>, <span style="color:#e6db74">&#39;Pass all keys to the page&#39;</span>)
<span style="color:#a6e22e">pass</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Page&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Escape&#39;</span>], <span style="color:#a6e22e">modal</span>, <span style="color:#e6db74">&#39;Stop passing keys to the page&#39;</span>)
</code></pre></div><h4 id="custom-contexts">Custom contexts</h4>
<p>Custom contexts can be created using filters.</p>
<p><strong>Example</strong> – Override the built-in link context:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, () =&gt; document.<span style="color:#a6e22e">activeElement</span>.<span style="color:#a6e22e">nodeName</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;A&#39;</span>, <span style="color:#e6db74">&#39;Command&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">enable</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, <span style="color:#e6db74">&#39;Text&#39;</span>, <span style="color:#e6db74">&#39;Command&#39;</span>)
</code></pre></div><p>The filter is a function that dictates in what context a mapping will be available.</p>
<p>A third parameter can be passed to inherit a context and its commands.
In the example above, <strong>Link</strong> inherits from <strong>Command</strong>.</p>
<h4 id="same-key-mappings">Same key mappings</h4>
<p>You can bind different commands to a same key.</p>
<p><strong>Example</strong> – Add mappings to yank pages and links:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyY&#39;</span>], () =&gt; <span style="color:#a6e22e">Clipboard</span>.<span style="color:#a6e22e">copy</span>(<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span>), <span style="color:#e6db74">&#39;Copy page address&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;KeyY&#39;</span>], (<span style="color:#a6e22e">event</span>) =&gt; <span style="color:#a6e22e">Clipboard</span>.<span style="color:#a6e22e">copy</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">href</span>), <span style="color:#e6db74">&#39;Copy link address&#39;</span>)
</code></pre></div><h4 id="specific-site-mappings">Specific site mappings</h4>
<p>Specific site bindings are also supported through custom contexts.</p>
<p><strong>Example</strong> – Disable shortcuts in Gmail:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#e6db74">&#39;Gmail&#39;</span>, () =&gt; <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">hostname</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;mail.google.com&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">enable</span>(<span style="color:#e6db74">&#39;Gmail&#39;</span>, ...)
</code></pre></div><p>Create a context for <a href="https://mail.google.com">Gmail</a> and use the <a href="https://support.google.com/mail/answer/6594">built-in shortcuts</a>.</p>
<p><strong>Example</strong> – Create a context for GitHub:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#e6db74">&#39;GitHub&#39;</span>, () =&gt; <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">hostname</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;github.com&#39;</span>, <span style="color:#e6db74">&#39;Command&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#e6db74">&#39;GitHub · Notifications&#39;</span>, () =&gt; <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">pathname</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;/notifications&#39;</span>, <span style="color:#e6db74">&#39;GitHub&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">enable</span>(<span style="color:#e6db74">&#39;GitHub · Notifications&#39;</span>, <span style="color:#e6db74">&#39;GitHub&#39;</span>, ...)

<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;GitHub · Notifications&#39;</span>, [<span style="color:#e6db74">&#39;KeyR&#39;</span>], () =&gt; document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;form[action=&#34;/notifications/mark&#34;]&#39;</span>).<span style="color:#a6e22e">submit</span>(), <span style="color:#e6db74">&#39;Mark all as read&#39;</span>)
</code></pre></div><h4 id="events">Events</h4>
<p>Commands can be registered to be executed when certain events arise.</p>
<p><strong>Example</strong> – Display the current context:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;context-change&#39;</span>, (<span style="color:#a6e22e">context</span>) =&gt; <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">notify</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;context&#39;</span>, <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">name</span> }))
</code></pre></div><h4 id="getting-help">Getting help</h4>
<p>Finally, you can display all available commands (for the current context) with the help command.</p>
<p><strong>Example</strong> – Show help on <code>F1</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Page&#39;</span>, [<span style="color:#e6db74">&#39;F1&#39;</span>], () =&gt; <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">help</span>(), <span style="color:#e6db74">&#39;Show help&#39;</span>)
</code></pre></div><h3 id="filters">Filters</h3>
<p>Add a method to create filters.</p>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">filter</span>, <span style="color:#a6e22e">parent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filters</span>[<span style="color:#a6e22e">name</span>] <span style="color:#f92672">=</span> { <span style="color:#a6e22e">filter</span>, <span style="color:#a6e22e">parent</span> }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">mappings</span>[<span style="color:#a6e22e">name</span>] <span style="color:#f92672">=</span> {}
  }
}
</code></pre></div><p>Update the constructor to include some default filters.
Add <code>isText()</code> as a static method.</p>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">name</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#e6db74">&#39;Page&#39;</span>, () =&gt; <span style="color:#66d9ef">true</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, () =&gt; <span style="color:#f92672">!</span> <span style="color:#a6e22e">Modal</span>.<span style="color:#a6e22e">isText</span>(document.<span style="color:#a6e22e">activeElement</span>), <span style="color:#e6db74">&#39;Page&#39;</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#e6db74">&#39;Text&#39;</span>, () =&gt; <span style="color:#a6e22e">Modal</span>.<span style="color:#a6e22e">isText</span>(document.<span style="color:#a6e22e">activeElement</span>), <span style="color:#e6db74">&#39;Page&#39;</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, () =&gt; document.<span style="color:#a6e22e">activeElement</span>.<span style="color:#a6e22e">nodeName</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;A&#39;</span>, <span style="color:#e6db74">&#39;Command&#39;</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, () =&gt; document.<span style="color:#a6e22e">activeElement</span>.<span style="color:#a6e22e">nodeName</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;VIDEO&#39;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">Modal</span>.<span style="color:#a6e22e">findParent</span>((<span style="color:#a6e22e">element</span>) =&gt; [<span style="color:#e6db74">&#39;html5-video-player&#39;</span>].<span style="color:#a6e22e">some</span>((<span style="color:#a6e22e">className</span>) =&gt; <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">contains</span>(<span style="color:#a6e22e">className</span>))), <span style="color:#e6db74">&#39;Page&#39;</span>)
  }
}
</code></pre></div><p>And the method to enable the filters.</p>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">name</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">enable</span>(<span style="color:#e6db74">&#39;Page&#39;</span>)
  }
  <span style="color:#a6e22e">enable</span>(...<span style="color:#a6e22e">filters</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">filters</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">filters</span>.<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">name</span>) =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filters</span>[<span style="color:#a6e22e">name</span>])
  }
}
</code></pre></div><h3 id="mappings">Mappings</h3>
<p><strong>Prototype</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">Modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">context</span>, <span style="color:#a6e22e">keys</span>, <span style="color:#a6e22e">command</span>, <span style="color:#a6e22e">description</span>)
</code></pre></div><p>Keys are parsed with:</p>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">parseKeys</span>(<span style="color:#a6e22e">keys</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keyChord</span> <span style="color:#f92672">=</span> {
      <span style="color:#a6e22e">metaKey</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
      <span style="color:#a6e22e">altKey</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
      <span style="color:#a6e22e">ctrlKey</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
      <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
      <span style="color:#a6e22e">code</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>
    }
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">keys</span>) {
      <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">key</span>) {
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;Shift&#39;</span><span style="color:#f92672">:</span>
          <span style="color:#a6e22e">keyChord</span>.<span style="color:#a6e22e">shiftKey</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
          <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;Control&#39;</span><span style="color:#f92672">:</span>
          <span style="color:#a6e22e">keyChord</span>.<span style="color:#a6e22e">ctrlKey</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
          <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;Alt&#39;</span><span style="color:#f92672">:</span>
          <span style="color:#a6e22e">keyChord</span>.<span style="color:#a6e22e">altKey</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
          <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;Meta&#39;</span><span style="color:#f92672">:</span>
          <span style="color:#a6e22e">keyChord</span>.<span style="color:#a6e22e">metaKey</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
          <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
          <span style="color:#a6e22e">keyChord</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">key</span>
      }
    }
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">keyChord</span>
  }
}
</code></pre></div><p>Commands are parsed with:</p>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">parseCommand</span>(<span style="color:#a6e22e">command</span>) {
    <span style="color:#66d9ef">switch</span> (<span style="color:#66d9ef">true</span>) {
      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">command</span> <span style="color:#66d9ef">instanceof</span> <span style="color:#a6e22e">Modal</span><span style="color:#f92672">:</span>
        <span style="color:#66d9ef">return</span> () =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">mode</span>(<span style="color:#a6e22e">command</span>)
      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">command</span> <span style="color:#66d9ef">instanceof</span> Function<span style="color:#f92672">:</span>
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">command</span>
    }
  }
}
</code></pre></div><p>If the command is a mode, generate a function to switch to it.</p>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">mode</span>(<span style="color:#a6e22e">nextMode</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">unlisten</span>()
    <span style="color:#a6e22e">nextMode</span>.<span style="color:#a6e22e">listen</span>()
  }
}
</code></pre></div><p>We can now implement the mapping methods.</p>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">context</span>, <span style="color:#a6e22e">keys</span>, <span style="color:#a6e22e">command</span>, <span style="color:#a6e22e">description</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keyChord</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Modal</span>.<span style="color:#a6e22e">parseKeys</span>(<span style="color:#a6e22e">keys</span>)
    <span style="color:#a6e22e">command</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">parseCommand</span>(<span style="color:#a6e22e">command</span>)
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">keyChord</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">mappings</span>[<span style="color:#a6e22e">context</span>][<span style="color:#a6e22e">key</span>] <span style="color:#f92672">=</span> { <span style="color:#a6e22e">command</span>, <span style="color:#a6e22e">description</span> }
  }
  <span style="color:#a6e22e">unmap</span>(<span style="color:#a6e22e">context</span>, <span style="color:#a6e22e">keys</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keyChord</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Modal</span>.<span style="color:#a6e22e">parseKeys</span>(<span style="color:#a6e22e">keys</span>)
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">keyChord</span>)
    <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">mappings</span>[<span style="color:#a6e22e">context</span>][<span style="color:#a6e22e">key</span>]
  }
}
</code></pre></div><p>For convenience, we will provide a function to find a parent element (useful for videos).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">findParent</span>(<span style="color:#a6e22e">find</span>, <span style="color:#a6e22e">element</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">activeElement</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">element</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>) {
      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>
    }
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">element</span>)
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">result</span>) {
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>
    }
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">findParent</span>(<span style="color:#a6e22e">find</span>, <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">parentElement</span>)
  }
}
</code></pre></div><h3 id="events-1">Events</h3>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">name</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span> <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#e6db74">&#39;context-change&#39;</span>] <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#e6db74">&#39;command&#39;</span>] <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#e6db74">&#39;default&#39;</span>] <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#e6db74">&#39;start&#39;</span>] <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#e6db74">&#39;stop&#39;</span>] <span style="color:#f92672">=</span> []
  }
}
</code></pre></div><p>Create a method to emit events.</p>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">on</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">listener</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#a6e22e">type</span>].<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">listener</span>)
  }
  <span style="color:#a6e22e">triggerEvent</span>(<span style="color:#a6e22e">type</span>, ...<span style="color:#a6e22e">parameters</span>) {
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">listener</span> <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#a6e22e">type</span>]) {
      <span style="color:#a6e22e">listener</span>(...<span style="color:#a6e22e">parameters</span>)
    }
  }
}
</code></pre></div><p>In order to execute a key depending on the context, we need to:</p>
<ul>
<li>Listen <a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code">key presses</a> with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/keydown_event">keydown</a> event,</li>
<li>Listen context changes with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/focus_event">focus</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/blur_event">blur</a> events.</li>
</ul>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">name</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span> <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">filters</span> <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">commands</span> <span style="color:#f92672">=</span> {}
  }
  <span style="color:#a6e22e">listen</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onKey</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
      <span style="color:#75715e">// Skip modifiers
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">Modal</span>.<span style="color:#a6e22e">MODIFIER_KEYS</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">key</span>)) {
        <span style="color:#66d9ef">return</span>
      }
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keyChord</span> <span style="color:#f92672">=</span> {
        <span style="color:#a6e22e">metaKey</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">metaKey</span>,
        <span style="color:#a6e22e">altKey</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">altKey</span>,
        <span style="color:#a6e22e">ctrlKey</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">ctrlKey</span>,
        <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">shiftKey</span>,
        <span style="color:#a6e22e">code</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">code</span>
      }
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">keyChord</span>)
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">command</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">commands</span>[<span style="color:#a6e22e">key</span>]
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">command</span>) {
        <span style="color:#75715e">// Prevent the browsers default behavior (such as opening a link)
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// and stop the propagation of the event.
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">preventDefault</span>()
        <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">stopImmediatePropagation</span>()
        <span style="color:#75715e">// Command
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">command</span>.<span style="color:#a6e22e">command</span>(<span style="color:#a6e22e">event</span>)
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;command&#39;</span>, <span style="color:#a6e22e">event</span>)
      } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;default&#39;</span>, <span style="color:#a6e22e">event</span>)
      }
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onFocus</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateContext</span>()
    }
    <span style="color:#75715e">// Use the capture method.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// This setting is important to trigger the listeners during the capturing phase
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// if we want to prevent bubbling.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Also, some events (such as focus and blur) do not bubble, so this setting
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// is important to trigger the listeners attached to the parents of the target.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Phase 1: Capturing phase: Window (1) → ChildElement (2) → Target (3)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Phase 2: Target phase: Target (1)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Phase 3: Bubbling phase: Window (3) ← ParentElement (2) ← Target (1)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// https://w3.org/TR/DOM-Level-3-Events#event-flow
</span><span style="color:#75715e"></span>    window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;keydown&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onKey</span>, <span style="color:#66d9ef">true</span>)
    window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;focus&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onFocus</span>, <span style="color:#66d9ef">true</span>)
    window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;blur&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onFocus</span>, <span style="color:#66d9ef">true</span>)
    <span style="color:#75715e">// Initialize active context
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateContext</span>()
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;start&#39;</span>)
  }
  <span style="color:#a6e22e">unlisten</span>() {
    window.<span style="color:#a6e22e">removeEventListener</span>(<span style="color:#e6db74">&#39;keydown&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onKey</span>, <span style="color:#66d9ef">true</span>)
    window.<span style="color:#a6e22e">removeEventListener</span>(<span style="color:#e6db74">&#39;focus&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onFocus</span>, <span style="color:#66d9ef">true</span>)
    window.<span style="color:#a6e22e">removeEventListener</span>(<span style="color:#e6db74">&#39;blur&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onFocus</span>, <span style="color:#66d9ef">true</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;stop&#39;</span>)
  }
  <span style="color:#a6e22e">getContexts</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">accumulator</span> <span style="color:#f92672">=</span> []) {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">name</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>) {
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">accumulator</span>
    }
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getContexts</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filters</span>[<span style="color:#a6e22e">name</span>].<span style="color:#a6e22e">parent</span>, <span style="color:#a6e22e">accumulator</span>.<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">name</span>))
  }
  <span style="color:#a6e22e">updateContext</span>() {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">previousContextName</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">name</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">filters</span>.<span style="color:#a6e22e">find</span>((<span style="color:#a6e22e">name</span>) =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getContexts</span>(<span style="color:#a6e22e">name</span>).<span style="color:#a6e22e">every</span>((<span style="color:#a6e22e">name</span>) =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filters</span>[<span style="color:#a6e22e">name</span>].<span style="color:#a6e22e">filter</span>()))
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">previousContextName</span>) {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateCommands</span>()
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;context-change&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>)
    }
  }
  <span style="color:#a6e22e">updateCommands</span>() {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">commands</span> <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">contexts</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getContexts</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">name</span>)
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">context</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">contexts</span>) {
      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">mapping</span>] <span style="color:#66d9ef">of</span> Object.<span style="color:#a6e22e">entries</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">mappings</span>[<span style="color:#a6e22e">context</span>])) {
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">commands</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span>) {
          <span style="color:#a6e22e">commands</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">=</span> { <span style="color:#a6e22e">context</span>, ...<span style="color:#a6e22e">mapping</span> }
        }
      }
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">commands</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">commands</span>
  }
}
</code></pre></div><h3 id="key-values">Key values</h3>
<p>Display <a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values">key values</a>.</p>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">KEY_MAP</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">Backquote</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;`&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;~&#39;</span> }, <span style="color:#a6e22e">Digit1</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;1&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;!&#39;</span> }, <span style="color:#a6e22e">Digit2</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;2&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;@&#39;</span> }, <span style="color:#a6e22e">Digit3</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;3&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#&#39;</span> }, <span style="color:#a6e22e">Digit4</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;4&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;$&#39;</span> }, <span style="color:#a6e22e">Digit5</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;5&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;%&#39;</span> }, <span style="color:#a6e22e">Digit6</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;6&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;^&#39;</span> }, <span style="color:#a6e22e">Digit7</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;7&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&amp;&#39;</span> }, <span style="color:#a6e22e">Digit8</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;8&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;*&#39;</span> }, <span style="color:#a6e22e">Digit9</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;9&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;(&#39;</span> }, <span style="color:#a6e22e">Digit0</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;)&#39;</span> }, <span style="color:#a6e22e">Minus</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;-&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;_&#39;</span> }, <span style="color:#a6e22e">Equal</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;=&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;+&#39;</span> },
    <span style="color:#a6e22e">KeyQ</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;q&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Q&#39;</span> }, <span style="color:#a6e22e">KeyW</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;w&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;W&#39;</span> }, <span style="color:#a6e22e">KeyE</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;E&#39;</span> }, <span style="color:#a6e22e">KeyR</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;r&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;R&#39;</span> }, <span style="color:#a6e22e">KeyT</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;t&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;T&#39;</span> }, <span style="color:#a6e22e">KeyY</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y&#39;</span> }, <span style="color:#a6e22e">KeyU</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;u&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;U&#39;</span> }, <span style="color:#a6e22e">KeyI</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;i&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;I&#39;</span> }, <span style="color:#a6e22e">KeyO</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;O&#39;</span> }, <span style="color:#a6e22e">KeyP</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;p&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;P&#39;</span> }, <span style="color:#a6e22e">BracketLeft</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;[&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;{&#39;</span> }, <span style="color:#a6e22e">BracketRight</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;]&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;}&#39;</span> }, <span style="color:#a6e22e">Backslash</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;\\&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;|&#39;</span> },
    <span style="color:#a6e22e">KeyA</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;A&#39;</span> }, <span style="color:#a6e22e">KeyS</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;s&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;S&#39;</span> }, <span style="color:#a6e22e">KeyD</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;D&#39;</span> }, <span style="color:#a6e22e">KeyF</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;F&#39;</span> }, <span style="color:#a6e22e">KeyG</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;g&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;G&#39;</span> }, <span style="color:#a6e22e">KeyH</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;h&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;H&#39;</span> }, <span style="color:#a6e22e">KeyJ</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;j&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;J&#39;</span> }, <span style="color:#a6e22e">KeyK</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;k&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;K&#39;</span> }, <span style="color:#a6e22e">KeyL</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;l&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;L&#39;</span> }, <span style="color:#a6e22e">Semicolon</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;;&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;:&#39;</span> }, <span style="color:#a6e22e">Quote</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#39;&#34;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#34;&#39;</span> },
    <span style="color:#a6e22e">KeyZ</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;z&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Z&#39;</span> }, <span style="color:#a6e22e">KeyX</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;X&#39;</span> }, <span style="color:#a6e22e">KeyC</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;C&#39;</span> }, <span style="color:#a6e22e">KeyV</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;v&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;V&#39;</span> }, <span style="color:#a6e22e">KeyB</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;B&#39;</span> }, <span style="color:#a6e22e">KeyN</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;n&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;N&#39;</span> }, <span style="color:#a6e22e">KeyM</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;m&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;M&#39;</span> }, <span style="color:#a6e22e">Comma</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&lt;&#39;</span> }, <span style="color:#a6e22e">Period</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;.&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&gt;&#39;</span> }, <span style="color:#a6e22e">Slash</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;?&#39;</span> }
  }
  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">name</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keyMap</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Modal</span>.<span style="color:#a6e22e">KEY_MAP</span>
  }
  <span style="color:#a6e22e">keyValues</span>({ <span style="color:#a6e22e">metaKey</span>, <span style="color:#a6e22e">altKey</span>, <span style="color:#a6e22e">ctrlKey</span>, <span style="color:#a6e22e">shiftKey</span>, <span style="color:#a6e22e">code</span> }) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keys</span> <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keyMap</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keyMap</span>[<span style="color:#a6e22e">code</span>]
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">metaKey</span>) <span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">push</span>(<span style="color:#e6db74">&#39;Meta&#39;</span>)
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">altKey</span>) <span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">push</span>(<span style="color:#e6db74">&#39;Alt&#39;</span>)
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">ctrlKey</span>) <span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">push</span>(<span style="color:#e6db74">&#39;Control&#39;</span>)
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">shiftKey</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span> <span style="color:#a6e22e">keyMap</span>) <span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">push</span>(<span style="color:#e6db74">&#39;Shift&#39;</span>)
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">keyMap</span>
      <span style="color:#f92672">?</span> <span style="color:#a6e22e">shiftKey</span>
      <span style="color:#f92672">?</span> <span style="color:#a6e22e">keyMap</span>.<span style="color:#a6e22e">shiftKey</span>
      <span style="color:#f92672">:</span> <span style="color:#a6e22e">keyMap</span>.<span style="color:#a6e22e">key</span>
      <span style="color:#f92672">:</span> <span style="color:#a6e22e">code</span>
    <span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">key</span>)
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">keys</span>
  }
}
</code></pre></div><h3 id="help">Help</h3>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">name</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span><span style="color:#e6db74">      #help.overlay {
</span><span style="color:#e6db74">        display: flex; /* Enable to center content */
</span><span style="color:#e6db74">        justify-content: center; /* Horizontally */
</span><span style="color:#e6db74">        align-items: center; /* Vertically */
</span><span style="color:#e6db74">        position: fixed;
</span><span style="color:#e6db74">        top: 0;
</span><span style="color:#e6db74">        left: 0;
</span><span style="color:#e6db74">        z-index: 2147483647; /* 2³¹ − 1 */
</span><span style="color:#e6db74">        width: 100%;
</span><span style="color:#e6db74">        height: 100%;
</span><span style="color:#e6db74">        background-color: hsla(0, 0%, 0%, 0.5);
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">      #help main {
</span><span style="color:#e6db74">        position: relative;
</span><span style="color:#e6db74">        width: fit-content;
</span><span style="color:#e6db74">        height: fit-content;
</span><span style="color:#e6db74">        max-width: 30%;
</span><span style="color:#e6db74">        max-height: 90%;
</span><span style="color:#e6db74">        overflow-x: auto;
</span><span style="color:#e6db74">        overflow-y: auto;
</span><span style="color:#e6db74">        font-family: serif;
</span><span style="color:#e6db74">        font-size: 12px;
</span><span style="color:#e6db74">        color: gray;
</span><span style="color:#e6db74">        background-color: white;
</span><span style="color:#e6db74">        border: 1px solid lightgray;
</span><span style="color:#e6db74">        border-radius: 4px;
</span><span style="color:#e6db74">        padding: 3px;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">      #help main table caption {
</span><span style="color:#e6db74">        font-size: 18px;
</span><span style="color:#e6db74">        font-weight: bold;
</span><span style="color:#e6db74">        padding: 10px 0;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">      /* Style from GitHub */
</span><span style="color:#e6db74">      kbd {
</span><span style="color:#e6db74">        background-color: #fafbfc;
</span><span style="color:#e6db74">        border: 1px solid #c6cbd1;
</span><span style="color:#e6db74">        border-bottom-color: #959da5;
</span><span style="color:#e6db74">        border-radius: 3px;
</span><span style="color:#e6db74">        box-shadow: inset 0 -1px 0 #959da5;
</span><span style="color:#e6db74">        color: #444d56;
</span><span style="color:#e6db74">        display: inline-block;
</span><span style="color:#e6db74">        font-family: monospace;
</span><span style="color:#e6db74">        font-size: 11px;
</span><span style="color:#e6db74">        line-height: 10px;
</span><span style="color:#e6db74">        padding: 3px 5px;
</span><span style="color:#e6db74">        vertical-align: middle;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">      /* Scrollbar */
</span><span style="color:#e6db74">      ::-webkit-scrollbar {
</span><span style="color:#e6db74">        height: 25px;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">      ::-webkit-scrollbar-button:start,
</span><span style="color:#e6db74">      ::-webkit-scrollbar-button:end {
</span><span style="color:#e6db74">        display: none;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">      ::-webkit-scrollbar-track-piece {
</span><span style="color:#e6db74">        background-color: #eee;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">      ::-webkit-scrollbar-thumb {
</span><span style="color:#e6db74">        background-color: #bbb;
</span><span style="color:#e6db74">        border: 7px solid #eee;
</span><span style="color:#e6db74">        -webkit-background-clip: padding-box;
</span><span style="color:#e6db74">        -webkit-border-radius: 12px;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">    `</span>
  }
  <span style="color:#a6e22e">help</span>() {
    <span style="color:#75715e">// Open or close help
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rootReference</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#modal-help&#39;</span>)
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">rootReference</span>) {
      <span style="color:#a6e22e">rootReference</span>.<span style="color:#a6e22e">remove</span>()
      <span style="color:#66d9ef">return</span>
    }
    <span style="color:#75715e">// Initialize
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
    <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;modal-help&#39;</span>
    <span style="color:#75715e">// Place the document in a closed shadow root,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// so that the document and page styles won’t affect each other.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shadow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">attachShadow</span>({ <span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;closed&#39;</span> })
    <span style="color:#75715e">// Container
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
    <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;help&#39;</span>
    <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;overlay&#39;</span>)
    <span style="color:#75715e">// Content
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;main&#39;</span>)
    <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">content</span>)
    <span style="color:#75715e">// Table
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">table</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;table&#39;</span>)
    <span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">table</span>)
    <span style="color:#75715e">// Caption
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">caption</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;caption&#39;</span>)
    <span style="color:#a6e22e">caption</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">name</span>
    <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">caption</span>)
    <span style="color:#75715e">// Commands
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">keyChord</span>, { <span style="color:#a6e22e">description</span> }] <span style="color:#66d9ef">of</span> Object.<span style="color:#a6e22e">entries</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">commands</span>)) {
      <span style="color:#75715e">// Table row
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">row</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;tr&#39;</span>)
      <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">row</span>)
      <span style="color:#75715e">// Table header cell
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">header</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;th&#39;</span>)
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keys</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keyValues</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">keyChord</span>))
      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">keys</span>) {
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">atom</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;kbd&#39;</span>)
        <span style="color:#a6e22e">atom</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">key</span>
        <span style="color:#a6e22e">header</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">atom</span>)
      }
      <span style="color:#a6e22e">row</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">header</span>)
      <span style="color:#75715e">// Table data cell
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;td&#39;</span>)
      <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">description</span>
      <span style="color:#a6e22e">row</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">data</span>)
    }
    <span style="color:#75715e">// Style
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;style&#39;</span>)
    <span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span>
    <span style="color:#75715e">// Attach
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">style</span>)
    <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">container</span>)
    document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">root</span>)
    <span style="color:#75715e">// Close on click
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;click&#39;</span>, (<span style="color:#a6e22e">event</span>) =&gt; {
      <span style="color:#75715e">// Stop propagation
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">stopImmediatePropagation</span>()
      <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">remove</span>()
    })
  }
}
</code></pre></div><h3 id="notifications">Notifications</h3>
<p><code>scripts/modal.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Modal</span> {
  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">name</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span><span style="color:#e6db74">      #notification {
</span><span style="color:#e6db74">        position: fixed;
</span><span style="color:#e6db74">        bottom: 0;
</span><span style="color:#e6db74">        right: 0;
</span><span style="color:#e6db74">        z-index: 2147483647; /* 2³¹ − 1 */
</span><span style="color:#e6db74">        font-family: serif;
</span><span style="color:#e6db74">        font-size: 12px;
</span><span style="color:#e6db74">        color: gray;
</span><span style="color:#e6db74">        background-color: white;
</span><span style="color:#e6db74">        border: 1px solid lightgray;
</span><span style="color:#e6db74">        border-top-left-radius: 4px;
</span><span style="color:#e6db74">        padding: 3px;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">    `</span>
  }
  <span style="color:#a6e22e">notify</span>({ <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> Date.<span style="color:#a6e22e">now</span>(), <span style="color:#a6e22e">message</span>, <span style="color:#a6e22e">duration</span> }) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">initialize</span> <span style="color:#f92672">=</span> () =&gt; {
      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#modal-notifications&#39;</span>)
      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span> <span style="color:#a6e22e">root</span>) {
        <span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
        <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;modal-notifications&#39;</span>
        document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">root</span>)
      }
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">root</span>
    }
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">clearViewport</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">root</span>, <span style="color:#a6e22e">id</span>) =&gt; {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">`[data-notification-id=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;]`</span>)
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">container</span>) {
        <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">remove</span>()
      }
    }
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">notifications</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">initialize</span>()
    <span style="color:#a6e22e">clearViewport</span>(<span style="color:#a6e22e">notifications</span>, <span style="color:#a6e22e">id</span>)
    <span style="color:#75715e">// Initialize
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
    <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#39;data-notification-id&#39;</span>, <span style="color:#a6e22e">id</span>)
    <span style="color:#75715e">// Place the document in a closed shadow root,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// so that the document and page styles won’t affect each other.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shadow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">attachShadow</span>({ <span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;closed&#39;</span> })
    <span style="color:#75715e">// Container
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
    <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;notification&#39;</span>
    <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">message</span>
    <span style="color:#75715e">// Style
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;style&#39;</span>)
    <span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span>
    <span style="color:#75715e">// Attach
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">style</span>)
    <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">container</span>)
    <span style="color:#a6e22e">notifications</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">root</span>)
    <span style="color:#75715e">// Duration of the notification (optional)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">duration</span>) {
      <span style="color:#a6e22e">setTimeout</span>(() =&gt; {
        <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">remove</span>()
      }, <span style="color:#a6e22e">duration</span>)
    }
  }
}
</code></pre></div><h3 id="configuration">Configuration</h3>
<p>Finally, update your configuration.</p>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Modes ───────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Modal
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">modal</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Modal</span>(<span style="color:#e6db74">&#39;Modal&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">enable</span>(<span style="color:#e6db74">&#39;Text&#39;</span>, <span style="color:#e6db74">&#39;Command&#39;</span>)

<span style="color:#75715e">// Mappings ────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Scroll
</span><span style="color:#75715e"></span><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyJ&#39;</span>], () =&gt; document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">60</span> }), <span style="color:#e6db74">&#39;Scroll down&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyK&#39;</span>], () =&gt; document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">60</span> }), <span style="color:#e6db74">&#39;Scroll up&#39;</span>)

<span style="color:#75715e">// Initialization ──────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">listen</span>()
</code></pre></div><h3 id="more-commands">More commands</h3>
<h4 id="scroll">Scroll</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyL&#39;</span>], () =&gt; document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">left</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">60</span> }), <span style="color:#e6db74">&#39;Scroll right&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyH&#39;</span>], () =&gt; document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">left</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">60</span> }), <span style="color:#e6db74">&#39;Scroll left&#39;</span>)
</code></pre></div><h4 id="scroll-faster">Scroll faster</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyJ&#39;</span>], () =&gt; document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> window.<span style="color:#a6e22e">innerHeight</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.9</span> }), <span style="color:#e6db74">&#39;Scroll page down&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyK&#39;</span>], () =&gt; document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span>window.<span style="color:#a6e22e">innerHeight</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.9</span> }), <span style="color:#e6db74">&#39;Scroll page up&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyG&#39;</span>], () =&gt; document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollTo</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span> }), <span style="color:#e6db74">&#39;Scroll to the top of the page&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyG&#39;</span>], () =&gt; document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollTo</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> document.<span style="color:#a6e22e">scrollingElement</span>.<span style="color:#a6e22e">scrollHeight</span> }), <span style="color:#e6db74">&#39;Scroll to the bottom of the page&#39;</span>)
</code></pre></div><h4 id="navigation">Navigation</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyH&#39;</span>], () =&gt; <span style="color:#a6e22e">history</span>.<span style="color:#a6e22e">back</span>(), <span style="color:#e6db74">&#39;Go back in history&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyL&#39;</span>], () =&gt; <span style="color:#a6e22e">history</span>.<span style="color:#a6e22e">forward</span>(), <span style="color:#e6db74">&#39;Go forward in history&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyU&#39;</span>], () =&gt; <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">assign</span>(<span style="color:#e6db74">&#39;..&#39;</span>), <span style="color:#e6db74">&#39;Go up in hierarchy&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyU&#39;</span>], () =&gt; <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">assign</span>(<span style="color:#e6db74">&#39;/&#39;</span>), <span style="color:#e6db74">&#39;Go to the home page&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyU&#39;</span>], () =&gt; <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">assign</span>(<span style="color:#e6db74">&#39;.&#39;</span>), <span style="color:#e6db74">&#39;Remove any URL parameter&#39;</span>)
</code></pre></div><h4 id="reload-pages">Reload pages</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyR&#39;</span>], () =&gt; <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">reload</span>(), <span style="color:#e6db74">&#39;Reload the page&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyR&#39;</span>], () =&gt; <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">reload</span>(<span style="color:#66d9ef">true</span>), <span style="color:#e6db74">&#39;Reload the page, ignoring cached content&#39;</span>)
</code></pre></div><h4 id="unfocus">Unfocus</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Page&#39;</span>, [<span style="color:#e6db74">&#39;Escape&#39;</span>], () =&gt; document.<span style="color:#a6e22e">activeElement</span>.<span style="color:#a6e22e">blur</span>(), <span style="color:#e6db74">&#39;Unfocus active element&#39;</span>)
</code></pre></div><h4 id="pass-keys">Pass keys</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Modes ───────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Pass
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pass</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Modal</span>(<span style="color:#e6db74">&#39;Pass&#39;</span>)

<span style="color:#75715e">// Mappings ────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Pass keys
</span><span style="color:#75715e"></span><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Page&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Escape&#39;</span>], <span style="color:#a6e22e">pass</span>, <span style="color:#e6db74">&#39;Pass all keys to the page&#39;</span>)
<span style="color:#a6e22e">pass</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Page&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Escape&#39;</span>], <span style="color:#a6e22e">modal</span>, <span style="color:#e6db74">&#39;Stop passing keys to the page&#39;</span>)
</code></pre></div><h4 id="status-line">Status line</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">updateStatusLine</span> <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">notify</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;status-line&#39;</span>, <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">name</span> })
}

<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;context-change&#39;</span>, (<span style="color:#a6e22e">context</span>) =&gt; <span style="color:#a6e22e">updateStatusLine</span>())
</code></pre></div><h4 id="help-1">Help</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Page&#39;</span>, [<span style="color:#e6db74">&#39;F1&#39;</span>], () =&gt; <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">help</span>(), <span style="color:#e6db74">&#39;Show help&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Page&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;F1&#39;</span>], () =&gt; window.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#39;https://alexherbo2.github.io/blog/chrome/create-a-keyboard-interface-to-the-web/&#39;</span>), <span style="color:#e6db74">&#39;Open the documentation in a new tab&#39;</span>)
</code></pre></div><p>Add more commands to your liking.</p>
<h3 id="updates">Updates</h3>
<p>If you want to be up-to-date with my <a href="https://github.com/alexherbo2/modal.js">version</a>, you can create a script
to retrieve updates and automate the process with a Makefile.</p>
<p><code>fetch</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>
fetch<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">case</span> $# in
    1<span style="color:#f92672">)</span> curl --location --remote-name $1 ;;
    2<span style="color:#f92672">)</span> curl --location $1 --output $2 ;;
  <span style="color:#66d9ef">esac</span>
<span style="color:#f92672">}</span>

mkdir -p packages
cd packages

fetch https://github.com/alexherbo2/modal.js/raw/master/scripts/modal.js
</code></pre></div><p>Make it executable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">chmod +x fetch
</code></pre></div><p><code>Makefile</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile"><span style="color:#a6e22e">fetch</span><span style="color:#f92672">:</span>
	./fetch

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
	rm -Rf packages

<span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> fetch
</code></pre></div><p>Don’t forget to ignore the packages.</p>
<p><code>.gitignore</code></p>
<pre><code class="language-gitignore" data-lang="gitignore">packages
</code></pre><h2 id="part-2-link-hints">Part 2: Link Hints</h2>
<p>The completed script can be downloaded <a href="https://github.com/alexherbo2/hint.js">here</a>.</p>
<h3 id="the-prototype">The Prototype</h3>
<p>Create the files and update your configuration.</p>
<p><code>scripts/hint.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hint</span> {
  <span style="color:#a6e22e">constructor</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">selectors</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;*&#39;</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keys</span> <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">lock</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">hints</span> <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">inputKeys</span> <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">validatedElements</span> <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keyMap</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Hint</span>.<span style="color:#a6e22e">KEY_MAP</span>
    <span style="color:#75715e">// Events
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span> <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#e6db74">&#39;validate&#39;</span>] <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#e6db74">&#39;start&#39;</span>] <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#e6db74">&#39;exit&#39;</span>] <span style="color:#f92672">=</span> []
    <span style="color:#75715e">// Style
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
  }
  <span style="color:#a6e22e">on</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">listener</span>) {
  }
  <span style="color:#a6e22e">start</span>() {
  }
  <span style="color:#a6e22e">stop</span>() {
  }
}
</code></pre></div><p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Modes ───────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Hint
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">HINT_TEXT_SELECTORS</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;input:not([type=&#34;submit&#34;]):not([type=&#34;button&#34;]):not([type=&#34;reset&#34;]):not([type=&#34;file&#34;]), textarea, select&#39;</span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">HINT_VIDEO_SELECTORS</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;video&#39;</span>

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hint</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">selectors</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;*&#39;</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hint</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Hint</span>
  <span style="color:#a6e22e">hint</span>.<span style="color:#a6e22e">selectors</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectors</span>
  <span style="color:#a6e22e">hint</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;validate&#39;</span>, (<span style="color:#a6e22e">target</span>) =&gt; <span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">focus</span>())
  <span style="color:#a6e22e">hint</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;start&#39;</span>, () =&gt; <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">unlisten</span>())
  <span style="color:#a6e22e">hint</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;exit&#39;</span>, () =&gt; <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">listen</span>())
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hint</span>
}

<span style="color:#75715e">// Mappings ────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Link hints
</span><span style="color:#75715e"></span><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyF&#39;</span>], () =&gt; <span style="color:#a6e22e">hint</span>().<span style="color:#a6e22e">start</span>(), <span style="color:#e6db74">&#39;Focus link&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyI&#39;</span>], () =&gt; <span style="color:#a6e22e">hint</span>(<span style="color:#a6e22e">HINT_TEXT_SELECTORS</span>).<span style="color:#a6e22e">start</span>(), <span style="color:#e6db74">&#39;Focus input&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyV&#39;</span>], () =&gt; <span style="color:#a6e22e">hint</span>(<span style="color:#a6e22e">HINT_VIDEO_SELECTORS</span>).<span style="color:#a6e22e">start</span>(), <span style="color:#e6db74">&#39;Focus video&#39;</span>)
</code></pre></div><p><code>manifest.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;content_scripts&#34;</span>: [
    {
      <span style="color:#f92672">&#34;matches&#34;</span>: [
        <span style="color:#e6db74">&#34;&lt;all_urls&gt;&#34;</span>
      ],
      <span style="color:#f92672">&#34;js&#34;</span>: [
        <span style="color:#e6db74">&#34;scripts/modal.js&#34;</span>,
        <span style="color:#e6db74">&#34;scripts/hint.js&#34;</span>,
        <span style="color:#e6db74">&#34;config.js&#34;</span>
      ]
    }
  ]
}
</code></pre></div><h3 id="filtering">Filtering</h3>
<p>Add a filter to select hintable elements.
An element is hintable if it is visible and clickable.</p>
<p><code>scripts/hint.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hint</span> {
  <span style="color:#a6e22e">start</span>() {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hintableElements</span> <span style="color:#f92672">=</span> Array.<span style="color:#a6e22e">from</span>(document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">selectors</span>)).<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">element</span>) =&gt; <span style="color:#a6e22e">Hint</span>.<span style="color:#a6e22e">isHintable</span>(<span style="color:#a6e22e">element</span>))
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">hintableElements</span>)
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">isHintable</span>(<span style="color:#a6e22e">element</span>) {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">isVisible</span>(<span style="color:#a6e22e">element</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">isClickable</span>(<span style="color:#a6e22e">element</span>)
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">isVisible</span>(<span style="color:#a6e22e">element</span>) {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">offsetParent</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">isInViewport</span>(<span style="color:#a6e22e">element</span>)
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">isInViewport</span>(<span style="color:#a6e22e">element</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rectangle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">getBoundingClientRect</span>()
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">top</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">bottom</span> <span style="color:#f92672">&lt;=</span> window.<span style="color:#a6e22e">innerHeight</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">right</span> <span style="color:#f92672">&lt;=</span> window.<span style="color:#a6e22e">innerWidth</span>
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">isClickable</span>(<span style="color:#a6e22e">element</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nodeNames</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;A&#39;</span>, <span style="color:#e6db74">&#39;BUTTON&#39;</span>, <span style="color:#e6db74">&#39;SELECT&#39;</span>, <span style="color:#e6db74">&#39;TEXTAREA&#39;</span>, <span style="color:#e6db74">&#39;INPUT&#39;</span>, <span style="color:#e6db74">&#39;VIDEO&#39;</span>]
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">roles</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;button&#39;</span>, <span style="color:#e6db74">&#39;checkbox&#39;</span>, <span style="color:#e6db74">&#39;combobox&#39;</span>, <span style="color:#e6db74">&#39;link&#39;</span>, <span style="color:#e6db74">&#39;menuitem&#39;</span>, <span style="color:#e6db74">&#39;menuitemcheckbox&#39;</span>, <span style="color:#e6db74">&#39;menuitemradio&#39;</span>, <span style="color:#e6db74">&#39;radio&#39;</span>, <span style="color:#e6db74">&#39;tab&#39;</span>, <span style="color:#e6db74">&#39;textbox&#39;</span>]
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">offsetParent</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">nodeNames</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">nodeName</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">roles</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#39;role&#39;</span>)) <span style="color:#f92672">||</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">hasAttribute</span>(<span style="color:#e6db74">&#39;onclick&#39;</span>))
  }
}
</code></pre></div><h3 id="rendering">Rendering</h3>
<p>Add a method to generate an HTML hint for each element.</p>
<p>We will place the hints in a closed <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_shadow_DOM">shadow root</a>,
so that the hint and page styles won’t affect each other.</p>
<p><code>scripts/hint.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hint</span> {
  <span style="color:#a6e22e">start</span>() {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hintableElements</span> <span style="color:#f92672">=</span> Array.<span style="color:#a6e22e">from</span>(document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">selectors</span>)).<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">element</span>) =&gt; <span style="color:#a6e22e">Hint</span>.<span style="color:#a6e22e">isHintable</span>(<span style="color:#a6e22e">element</span>))
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">hintableElements</span>)
  }
  <span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">elements</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
    <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;hints&#39;</span>
    <span style="color:#75715e">// Place the hints in a closed shadow root,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// so that the hint and page styles won’t affect each other.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shadow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">attachShadow</span>({ <span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;closed&#39;</span> })
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">element</span>] <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">entries</span>()) {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;hint&#39;</span>)
      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">index</span>
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rectangle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">getBoundingClientRect</span>()
      <span style="color:#75715e">// Place hints relative to the viewport
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">position</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;fixed&#39;</span>
      <span style="color:#75715e">// Vertical placement: center
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">top</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">top</span> <span style="color:#f92672">+</span> (<span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px&#39;</span>
      <span style="color:#75715e">// Horizontal placement: left
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px&#39;</span>
      <span style="color:#75715e">// Control overlapping
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">zIndex</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2147483647</span> <span style="color:#75715e">// 2³¹ − 1
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">container</span>)
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">clearViewport</span>()
    <span style="color:#75715e">// Style
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;style&#39;</span>)
    <span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span>
    <span style="color:#75715e">// Attach
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">style</span>)
    document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">root</span>)
  }
  <span style="color:#a6e22e">clearViewport</span>() {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#hints&#39;</span>)
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">root</span>) {
      <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">remove</span>()
    }
  }
}
</code></pre></div><p>Configure which characters appear in hints.</p>
<p><code>scripts/hint.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hint</span> {
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">KEY_MAP</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">Digit1</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;1&#39;</span>, <span style="color:#a6e22e">Digit2</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;2&#39;</span>, <span style="color:#a6e22e">Digit3</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;3&#39;</span>, <span style="color:#a6e22e">Digit4</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;4&#39;</span>, <span style="color:#a6e22e">Digit5</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;5&#39;</span>, <span style="color:#a6e22e">Digit6</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;6&#39;</span>, <span style="color:#a6e22e">Digit7</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;7&#39;</span>, <span style="color:#a6e22e">Digit8</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;8&#39;</span>, <span style="color:#a6e22e">Digit9</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;9&#39;</span>, <span style="color:#a6e22e">Digit0</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;0&#39;</span>,
    <span style="color:#a6e22e">KeyQ</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;q&#39;</span>, <span style="color:#a6e22e">KeyW</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;w&#39;</span>, <span style="color:#a6e22e">KeyE</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#a6e22e">KeyR</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;r&#39;</span>, <span style="color:#a6e22e">KeyT</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;t&#39;</span>, <span style="color:#a6e22e">KeyY</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;y&#39;</span>, <span style="color:#a6e22e">KeyU</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;u&#39;</span>, <span style="color:#a6e22e">KeyI</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;i&#39;</span>, <span style="color:#a6e22e">KeyO</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#a6e22e">KeyP</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;p&#39;</span>,
    <span style="color:#a6e22e">KeyA</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#a6e22e">KeyS</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;s&#39;</span>, <span style="color:#a6e22e">KeyD</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#a6e22e">KeyF</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#a6e22e">KeyG</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;g&#39;</span>, <span style="color:#a6e22e">KeyH</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;h&#39;</span>, <span style="color:#a6e22e">KeyJ</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;j&#39;</span>, <span style="color:#a6e22e">KeyK</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;k&#39;</span>, <span style="color:#a6e22e">KeyL</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;l&#39;</span>,
    <span style="color:#a6e22e">KeyZ</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;z&#39;</span>, <span style="color:#a6e22e">KeyX</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#a6e22e">KeyC</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#a6e22e">KeyV</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;v&#39;</span>, <span style="color:#a6e22e">KeyB</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#a6e22e">KeyN</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;n&#39;</span>, <span style="color:#a6e22e">KeyM</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;m&#39;</span>
  }
  <span style="color:#a6e22e">constructor</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keys</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;KeyA&#39;</span>, <span style="color:#e6db74">&#39;KeyJ&#39;</span>, <span style="color:#e6db74">&#39;KeyS&#39;</span>, <span style="color:#e6db74">&#39;KeyK&#39;</span>, <span style="color:#e6db74">&#39;KeyD&#39;</span>, <span style="color:#e6db74">&#39;KeyL&#39;</span>, <span style="color:#e6db74">&#39;KeyG&#39;</span>, <span style="color:#e6db74">&#39;KeyH&#39;</span>, <span style="color:#e6db74">&#39;KeyE&#39;</span>, <span style="color:#e6db74">&#39;KeyW&#39;</span>, <span style="color:#e6db74">&#39;KeyO&#39;</span>, <span style="color:#e6db74">&#39;KeyR&#39;</span>, <span style="color:#e6db74">&#39;KeyU&#39;</span>, <span style="color:#e6db74">&#39;KeyV&#39;</span>, <span style="color:#e6db74">&#39;KeyN&#39;</span>, <span style="color:#e6db74">&#39;KeyC&#39;</span>, <span style="color:#e6db74">&#39;KeyM&#39;</span>]
  }
  <span style="color:#a6e22e">start</span>() {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hintableElements</span> <span style="color:#f92672">=</span> Array.<span style="color:#a6e22e">from</span>(document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">selectors</span>)).<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">element</span>) =&gt; <span style="color:#a6e22e">Hint</span>.<span style="color:#a6e22e">isHintable</span>(<span style="color:#a6e22e">element</span>))
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">hints</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Hint</span>.<span style="color:#a6e22e">generateHints</span>(<span style="color:#a6e22e">hintableElements</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keys</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">render</span>()
  }
  <span style="color:#a6e22e">render</span>() {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
    <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;hints&#39;</span>
    <span style="color:#75715e">// Place the hints in a closed shadow root,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// so that the hint and page styles won’t affect each other.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shadow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">attachShadow</span>({ <span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;closed&#39;</span> })
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">label</span>, <span style="color:#a6e22e">element</span>] <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">hints</span>) {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;hint&#39;</span>)
      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">label</span>
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rectangle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">getBoundingClientRect</span>()
      <span style="color:#75715e">// Place hints relative to the viewport
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">position</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;fixed&#39;</span>
      <span style="color:#75715e">// Vertical placement: center
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">top</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">top</span> <span style="color:#f92672">+</span> (<span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px&#39;</span>
      <span style="color:#75715e">// Horizontal placement: left
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px&#39;</span>
      <span style="color:#75715e">// Control overlapping
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">zIndex</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2147483647</span> <span style="color:#75715e">// 2³¹ − 1
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">container</span>)
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">clearViewport</span>()
    <span style="color:#75715e">// Style
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;style&#39;</span>)
    <span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span>
    <span style="color:#75715e">// Attach
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">style</span>)
    document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">root</span>)
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">generateHints</span>(<span style="color:#a6e22e">elements</span>, <span style="color:#a6e22e">keys</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hintKeys</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">generateHintKeys</span>(<span style="color:#a6e22e">keys</span>, <span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">length</span>)
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hints</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">index</span>) =&gt; [<span style="color:#a6e22e">hintKeys</span>[<span style="color:#a6e22e">index</span>], <span style="color:#a6e22e">element</span>])
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hints</span>
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">generateHintKeys</span>(<span style="color:#a6e22e">keys</span>, <span style="color:#a6e22e">count</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hints</span> <span style="color:#f92672">=</span> [[]]
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">offset</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">hints</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">offset</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">count</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">hints</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">1</span>) {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hint</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hints</span>[<span style="color:#a6e22e">offset</span><span style="color:#f92672">++</span>]
      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">keys</span>) {
        <span style="color:#a6e22e">hints</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">hint</span>.<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">key</span>))
      }
    }
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hints</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">offset</span>, <span style="color:#a6e22e">offset</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">count</span>)
  }
}
</code></pre></div><p>Add some CSS.</p>
<p><code>scripts/hint.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hint</span> {
  <span style="color:#a6e22e">constructor</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span><span style="color:#e6db74">      .hint {
</span><span style="color:#e6db74">        /* Hints */
</span><span style="color:#e6db74">        padding: 0.15rem 0.25rem;
</span><span style="color:#e6db74">        border: 1px solid hsl(39, 70%, 45%);
</span><span style="color:#e6db74">        text-transform: uppercase;
</span><span style="color:#e6db74">        text-align: center;
</span><span style="color:#e6db74">        vertical-align: middle;
</span><span style="color:#e6db74">        background: linear-gradient(to bottom, hsl(56, 100%, 76%) 0%, hsl(42, 100%, 63%) 100%);
</span><span style="color:#e6db74">        border-radius: 4px;
</span><span style="color:#e6db74">        box-shadow: 0 3px 1px -2px hsla(0, 0%, 0%, 0.2), 0 2px 2px 0 hsla(0, 0%, 0%, 0.14), 0 1px 5px 0 hsla(0, 0%, 0%, 0.12);
</span><span style="color:#e6db74">        transform: translate3d(0%, -50%, 0);
</span><span style="color:#e6db74">        /* Characters */
</span><span style="color:#e6db74">        font-family: Roboto, sans-serif;
</span><span style="color:#e6db74">        font-size: 12px;
</span><span style="color:#e6db74">        font-weight: 900;
</span><span style="color:#e6db74">        color: hsl(45, 81%, 10%);
</span><span style="color:#e6db74">        text-shadow: 0 1px 0 hsla(0, 0%, 100%, 0.6);
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">    `</span>
  }
}
</code></pre></div><h3 id="updating">Updating</h3>
<p>Update hints whenever the viewport changes.</p>
<p><code>scripts/hint.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hint</span> {
  <span style="color:#a6e22e">updateHints</span>() {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hintableElements</span> <span style="color:#f92672">=</span> Array.<span style="color:#a6e22e">from</span>(document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">selectors</span>)).<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">element</span>) =&gt; <span style="color:#a6e22e">Hint</span>.<span style="color:#a6e22e">isHintable</span>(<span style="color:#a6e22e">element</span>))
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">hints</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Hint</span>.<span style="color:#a6e22e">generateHints</span>(<span style="color:#a6e22e">hintableElements</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keys</span>)
  }
  <span style="color:#a6e22e">start</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onViewChange</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateHints</span>()
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">render</span>()
    }
    window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;scroll&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onViewChange</span>)
    window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;resize&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onViewChange</span>)
    <span style="color:#75715e">// Retrieve hints and render
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateHints</span>()
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">render</span>()
  }
  <span style="color:#a6e22e">stop</span>() {
    window.<span style="color:#a6e22e">removeEventListener</span>(<span style="color:#e6db74">&#39;scroll&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onViewChange</span>)
    window.<span style="color:#a6e22e">removeEventListener</span>(<span style="color:#e6db74">&#39;resize&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onViewChange</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">clearViewport</span>()
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">hints</span> <span style="color:#f92672">=</span> []
  }
}
</code></pre></div><h3 id="input-handler">Input handler</h3>
<p>We will use the same pattern as in <a href="#events">Part 1</a>.
We also need to modify the render method to take into account the input changes.</p>
<p><code>scripts/hint.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hint</span> {
  <span style="color:#75715e">// https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">MODIFIER_KEYS</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;Control&#39;</span>, <span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Meta&#39;</span>]
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">NAVIGATION_KEYS</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;ArrowDown&#39;</span>, <span style="color:#e6db74">&#39;ArrowLeft&#39;</span>, <span style="color:#e6db74">&#39;ArrowRight&#39;</span>, <span style="color:#e6db74">&#39;ArrowUp&#39;</span>, <span style="color:#e6db74">&#39;End&#39;</span>, <span style="color:#e6db74">&#39;Home&#39;</span>, <span style="color:#e6db74">&#39;PageDown&#39;</span>, <span style="color:#e6db74">&#39;PageUp&#39;</span>]
  <span style="color:#a6e22e">filterHints</span>(<span style="color:#a6e22e">input</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">filteredHints</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">hints</span>.<span style="color:#a6e22e">filter</span>(([<span style="color:#a6e22e">label</span>]) =&gt; <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">every</span>((<span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">index</span>) =&gt; <span style="color:#a6e22e">label</span>[<span style="color:#a6e22e">index</span>] <span style="color:#f92672">===</span> <span style="color:#a6e22e">key</span>))
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">filteredHints</span>
  }
  <span style="color:#a6e22e">processKeys</span>(<span style="color:#a6e22e">keys</span>, <span style="color:#a6e22e">validate</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">filteredHints</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filterHints</span>(<span style="color:#a6e22e">keys</span>)
    <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">filteredHints</span>.<span style="color:#a6e22e">length</span>) {
      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>
        <span style="color:#66d9ef">break</span>
      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">inputKeys</span> <span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">render</span>()
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">processHint</span>(<span style="color:#a6e22e">filteredHints</span>[<span style="color:#ae81ff">0</span>])
        <span style="color:#66d9ef">break</span>
      <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">validate</span>) {
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">inputKeys</span> <span style="color:#f92672">=</span> []
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">render</span>()
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">processHint</span>(<span style="color:#a6e22e">filteredHints</span>[<span style="color:#ae81ff">0</span>])
        } <span style="color:#66d9ef">else</span> {
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">inputKeys</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">keys</span>
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">render</span>()
        }
    }
  }
  <span style="color:#a6e22e">processHint</span>([<span style="color:#a6e22e">label</span>, <span style="color:#a6e22e">element</span>]) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">validatedElements</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">element</span>)
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">lock</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">false</span>) {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">stop</span>()
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;validate&#39;</span>, <span style="color:#a6e22e">element</span>)
  }
  <span style="color:#a6e22e">start</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onKey</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
      <span style="color:#75715e">// Skip modifier and navigation keys
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> ([...<span style="color:#a6e22e">Hint</span>.<span style="color:#a6e22e">MODIFIER_KEYS</span>, ...<span style="color:#a6e22e">Hint</span>.<span style="color:#a6e22e">NAVIGATION_KEYS</span>].<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">key</span>)) {
        <span style="color:#66d9ef">return</span>
      }
      <span style="color:#75715e">// Prevent the browsers default behavior (such as opening a link)
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// and stop the propagation of the event.
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">preventDefault</span>()
      <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">stopImmediatePropagation</span>()
      <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">code</span>) {
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;Escape&#39;</span><span style="color:#f92672">:</span>
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">stop</span>()
          <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;Backspace&#39;</span><span style="color:#f92672">:</span>
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">processKeys</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">inputKeys</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>))
          <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;Enter&#39;</span><span style="color:#f92672">:</span>
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">processKeys</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">inputKeys</span>, <span style="color:#66d9ef">true</span>)
          <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">processKeys</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">inputKeys</span>.<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">code</span>))
      }
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onViewChange</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateHints</span>()
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">processKeys</span>([])
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onClick</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">stop</span>()
    }
    <span style="color:#75715e">// Use the capture method.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// This setting is important to trigger the listeners during the capturing phase
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// if we want to prevent bubbling.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Phase 1: Capturing phase: Window (1) → ChildElement (2) → Target (3)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Phase 2: Target phase: Target (1)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Phase 3: Bubbling phase: Window (3) ← ParentElement (2) ← Target (1)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// https://w3.org/TR/DOM-Level-3-Events#event-flow
</span><span style="color:#75715e"></span>    window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;keydown&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onKey</span>, <span style="color:#66d9ef">true</span>)
    window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;scroll&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onViewChange</span>)
    window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;resize&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onViewChange</span>)
    window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;click&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onClick</span>)
    <span style="color:#75715e">// Start before processing hints
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;start&#39;</span>)
    <span style="color:#75715e">// Process hints
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateHints</span>()
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">processKeys</span>([])
  }
  <span style="color:#a6e22e">stop</span>() {
    window.<span style="color:#a6e22e">removeEventListener</span>(<span style="color:#e6db74">&#39;keydown&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onKey</span>, <span style="color:#66d9ef">true</span>)
    window.<span style="color:#a6e22e">removeEventListener</span>(<span style="color:#e6db74">&#39;scroll&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onViewChange</span>)
    window.<span style="color:#a6e22e">removeEventListener</span>(<span style="color:#e6db74">&#39;resize&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onViewChange</span>)
    window.<span style="color:#a6e22e">removeEventListener</span>(<span style="color:#e6db74">&#39;click&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onClick</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">clearViewport</span>()
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;exit&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">validatedElements</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">hints</span> <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">inputKeys</span> <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">validatedElements</span> <span style="color:#f92672">=</span> []
  }
  <span style="color:#a6e22e">render</span>() {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
    <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;hints&#39;</span>
    <span style="color:#75715e">// Place the hints in a closed shadow root,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// so that the hint and page styles won’t affect each other.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shadow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">attachShadow</span>({ <span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;closed&#39;</span> })
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">label</span>, <span style="color:#a6e22e">element</span>] <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filterHints</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">inputKeys</span>)) {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;hint&#39;</span>)
      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">code</span>] <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">label</span>.<span style="color:#a6e22e">entries</span>()) {
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">atom</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;span&#39;</span>)
        <span style="color:#a6e22e">atom</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;character&#39;</span>, <span style="color:#a6e22e">code</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">inputKeys</span>[<span style="color:#a6e22e">index</span>] <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;active&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;normal&#39;</span>)
        <span style="color:#a6e22e">atom</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keyMap</span>[<span style="color:#a6e22e">code</span>]
        <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">atom</span>)
      }
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rectangle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">getBoundingClientRect</span>()
      <span style="color:#75715e">// Place hints relative to the viewport
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">position</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;fixed&#39;</span>
      <span style="color:#75715e">// Vertical placement: center
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">top</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">top</span> <span style="color:#f92672">+</span> (<span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px&#39;</span>
      <span style="color:#75715e">// Horizontal placement: left
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px&#39;</span>
      <span style="color:#75715e">// Control overlapping
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">zIndex</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2147483647</span> <span style="color:#75715e">// 2³¹ − 1
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">container</span>)
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">clearViewport</span>()
    <span style="color:#75715e">// Style
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;style&#39;</span>)
    <span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span>
    <span style="color:#75715e">// Attach
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">style</span>)
    document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">root</span>)
  }
}
</code></pre></div><p>Update your CSS.</p>
<p><code>scripts/hint.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hint</span> {
  <span style="color:#a6e22e">constructor</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span><span style="color:#e6db74">      .hint {
</span><span style="color:#e6db74">        padding: 0.15rem 0.25rem;
</span><span style="color:#e6db74">        border: 1px solid hsl(39, 70%, 45%);
</span><span style="color:#e6db74">        text-transform: uppercase;
</span><span style="color:#e6db74">        text-align: center;
</span><span style="color:#e6db74">        vertical-align: middle;
</span><span style="color:#e6db74">        background: linear-gradient(to bottom, hsl(56, 100%, 76%) 0%, hsl(42, 100%, 63%) 100%);
</span><span style="color:#e6db74">        border-radius: 4px;
</span><span style="color:#e6db74">        box-shadow: 0 3px 1px -2px hsla(0, 0%, 0%, 0.2), 0 2px 2px 0 hsla(0, 0%, 0%, 0.14), 0 1px 5px 0 hsla(0, 0%, 0%, 0.12);
</span><span style="color:#e6db74">        transform: translate3d(0%, -50%, 0);
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">      .hint .character {
</span><span style="color:#e6db74">        font-family: Roboto, sans-serif;
</span><span style="color:#e6db74">        font-size: 12px;
</span><span style="color:#e6db74">        font-weight: 900;
</span><span style="color:#e6db74">        color: hsl(45, 81%, 10%);
</span><span style="color:#e6db74">        text-shadow: 0 1px 0 hsla(0, 0%, 100%, 0.6);
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">      .hint .character.active {
</span><span style="color:#e6db74">        color: hsl(44, 64%, 53%);
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">    `</span>
  }
}
</code></pre></div><h3 id="updates-1">Updates</h3>
<p>The <a href="#updates">same method</a> applies to <a href="#part-1-modal">Part 1</a> if you want to be up-to-date with my <a href="https://github.com/alexherbo2/hint.js">version</a>.</p>
<h2 id="part-3-toolbox">Part 3: Toolbox</h2>
<h3 id="mouse">Mouse</h3>
<p>The completed script can be downloaded <a href="https://github.com/alexherbo2/mouse.js">here</a>.</p>
<p><code>scripts/mouse.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Mouse</span> {
  <span style="color:#a6e22e">constructor</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">timers</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>
  }
  <span style="color:#a6e22e">hover</span>(<span style="color:#a6e22e">target</span>) {
    <span style="color:#a6e22e">Mouse</span>.<span style="color:#a6e22e">hover</span>(<span style="color:#a6e22e">target</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">timers</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">setTimeout</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">hover</span>.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">target</span>), <span style="color:#ae81ff">200</span>))
  }
  <span style="color:#a6e22e">unhover</span>(<span style="color:#a6e22e">target</span>) {
    <span style="color:#a6e22e">clearTimeout</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">timers</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">target</span>))
    <span style="color:#a6e22e">Mouse</span>.<span style="color:#a6e22e">unhover</span>(<span style="color:#a6e22e">target</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">timers</span>.<span style="color:#66d9ef">delete</span>(<span style="color:#a6e22e">target</span>)
  }
  <span style="color:#a6e22e">clear</span>() {
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">timer</span>] <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">timers</span>) {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">unhover</span>(<span style="color:#a6e22e">target</span>)
    }
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">click</span>(<span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">modifierKeys</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">dispatchEvents</span>(<span style="color:#a6e22e">target</span>, [<span style="color:#e6db74">&#39;mouseover&#39;</span>, <span style="color:#e6db74">&#39;mousedown&#39;</span>, <span style="color:#e6db74">&#39;mouseup&#39;</span>, <span style="color:#e6db74">&#39;click&#39;</span>], <span style="color:#a6e22e">modifierKeys</span>)
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">hover</span>(<span style="color:#a6e22e">target</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">dispatchEvents</span>(<span style="color:#a6e22e">target</span>, [<span style="color:#e6db74">&#39;mouseover&#39;</span>, <span style="color:#e6db74">&#39;mouseenter&#39;</span>, <span style="color:#e6db74">&#39;mousemove&#39;</span>])
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">unhover</span>(<span style="color:#a6e22e">target</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">dispatchEvents</span>(<span style="color:#a6e22e">target</span>, [<span style="color:#e6db74">&#39;mousemove&#39;</span>, <span style="color:#e6db74">&#39;mouseout&#39;</span>, <span style="color:#e6db74">&#39;mouseleave&#39;</span>])
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">dispatchEvents</span>(<span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">events</span>, { <span style="color:#a6e22e">shiftKey</span>, <span style="color:#a6e22e">ctrlKey</span>, <span style="color:#a6e22e">altKey</span>, <span style="color:#a6e22e">metaKey</span> } <span style="color:#f92672">=</span> {}) {
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">type</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">events</span>) {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">event</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">MouseEvent</span>(<span style="color:#a6e22e">type</span>, {
        <span style="color:#a6e22e">bubbles</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
        <span style="color:#a6e22e">cancelable</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
        <span style="color:#a6e22e">view</span><span style="color:#f92672">:</span> window,
        <span style="color:#a6e22e">shiftKey</span>,
        <span style="color:#a6e22e">ctrlKey</span>,
        <span style="color:#a6e22e">altKey</span>,
        <span style="color:#a6e22e">metaKey</span>
      })
      <span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">dispatchEvent</span>(<span style="color:#a6e22e">event</span>)
    }
  }
}
</code></pre></div><h4 id="show-video-controls">Show video controls</h4>
<p>Update Hint configuration to show video controls.</p>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Modes ───────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Hint
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hint</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">selectors</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;*&#39;</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hint</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Hint</span>
  <span style="color:#a6e22e">hint</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;start&#39;</span>, () =&gt; {
    <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">unlisten</span>()
    <span style="color:#75715e">// Show video controls
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">videos</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#e6db74">&#39;video&#39;</span>)
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">video</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">videos</span>) {
      <span style="color:#a6e22e">mouse</span>.<span style="color:#a6e22e">hover</span>(<span style="color:#a6e22e">video</span>)
    }
  })
  <span style="color:#a6e22e">hint</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;exit&#39;</span>, () =&gt; {
    <span style="color:#a6e22e">mouse</span>.<span style="color:#a6e22e">clear</span>()
    <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">listen</span>()
  })
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hint</span>
}

<span style="color:#75715e">// Tools ───────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mouse</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Mouse</span>
</code></pre></div><h3 id="clipboard">Clipboard</h3>
<p>The completed script can be downloaded <a href="https://github.com/alexherbo2/clipboard.js">here</a>.</p>
<p><code>scripts/clipboard.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Clipboard</span> {
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">copy</span>(<span style="color:#a6e22e">text</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">activeElement</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">activeElement</span>
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">textArea</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;textarea&#39;</span>)
    <span style="color:#a6e22e">textArea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">position</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;fixed&#39;</span>
    <span style="color:#a6e22e">textArea</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">text</span>
    document.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">textArea</span>)
    <span style="color:#a6e22e">textArea</span>.<span style="color:#a6e22e">select</span>()
    document.<span style="color:#a6e22e">execCommand</span>(<span style="color:#e6db74">&#39;copy&#39;</span>)
    <span style="color:#a6e22e">textArea</span>.<span style="color:#a6e22e">remove</span>()
    <span style="color:#a6e22e">activeElement</span>.<span style="color:#a6e22e">focus</span>()
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">paste</span>() {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">activeElement</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">activeElement</span>
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">textArea</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;textarea&#39;</span>)
    <span style="color:#a6e22e">textArea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">position</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;fixed&#39;</span>
    document.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">textArea</span>)
    <span style="color:#a6e22e">textArea</span>.<span style="color:#a6e22e">focus</span>()
    document.<span style="color:#a6e22e">execCommand</span>(<span style="color:#e6db74">&#39;paste&#39;</span>)
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">textArea</span>.<span style="color:#a6e22e">value</span>
    <span style="color:#a6e22e">textArea</span>.<span style="color:#a6e22e">remove</span>()
    <span style="color:#a6e22e">activeElement</span>.<span style="color:#a6e22e">focus</span>()
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">text</span>
  }
}
</code></pre></div><p>Update your manifest if you need to <a href="https://developer.chrome.com/extensions/declare_permissions">read the clipboard contents</a>.</p>
<p><code>manifest.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;permissions&#34;</span>: [
    <span style="color:#e6db74">&#34;clipboardRead&#34;</span>
  ]
}
</code></pre></div><h4 id="yank">Yank</h4>
<p>Update your configuration to yank pages and links.</p>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Modes ───────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Modal
</span><span style="color:#75715e"></span><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">enable</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, <span style="color:#e6db74">&#39;Text&#39;</span>, <span style="color:#e6db74">&#39;Command&#39;</span>)

<span style="color:#75715e">// Commands ────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">notify</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">message</span>) =&gt; {
  <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">notify</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;information&#39;</span>, <span style="color:#a6e22e">message</span>, <span style="color:#a6e22e">duration</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3000</span> })
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">copyToClipboard</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">message</span>) =&gt; {
  <span style="color:#a6e22e">Clipboard</span>.<span style="color:#a6e22e">copy</span>(<span style="color:#a6e22e">text</span>)
  <span style="color:#a6e22e">notify</span>(<span style="color:#a6e22e">message</span>)
}

<span style="color:#75715e">// Mappings ────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Clipboard
</span><span style="color:#75715e"></span><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyY&#39;</span>], () =&gt; <span style="color:#a6e22e">copyToClipboard</span>(<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span>, <span style="color:#e6db74">&#39;Page address copied&#39;</span>), <span style="color:#e6db74">&#39;Copy page address&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyY&#39;</span>], () =&gt; <span style="color:#a6e22e">copyToClipboard</span>(document.<span style="color:#a6e22e">title</span>, <span style="color:#e6db74">&#39;Page title copied&#39;</span>), <span style="color:#e6db74">&#39;Copy page title&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyY&#39;</span>], () =&gt; <span style="color:#a6e22e">copyToClipboard</span>(<span style="color:#e6db74">`[</span><span style="color:#e6db74">${</span>document.<span style="color:#a6e22e">title</span><span style="color:#e6db74">}</span><span style="color:#e6db74">](</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)`</span>, <span style="color:#e6db74">&#39;Page address and title copied&#39;</span>), <span style="color:#e6db74">&#39;Copy page address and title&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;KeyY&#39;</span>], (<span style="color:#a6e22e">event</span>) =&gt; <span style="color:#a6e22e">copyToClipboard</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">href</span>, <span style="color:#e6db74">&#39;Link address copied&#39;</span>), <span style="color:#e6db74">&#39;Copy link address&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyY&#39;</span>], (<span style="color:#a6e22e">event</span>) =&gt; <span style="color:#a6e22e">copyToClipboard</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">textContent</span>, <span style="color:#e6db74">&#39;Link text copied&#39;</span>), <span style="color:#e6db74">&#39;Copy link text&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyY&#39;</span>], (<span style="color:#a6e22e">event</span>) =&gt; <span style="color:#a6e22e">copyToClipboard</span>(<span style="color:#e6db74">`[</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">textContent</span><span style="color:#e6db74">}</span><span style="color:#e6db74">](</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">href</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)`</span>, <span style="color:#e6db74">&#39;Link address and text copied&#39;</span>), <span style="color:#e6db74">&#39;Copy link address and text&#39;</span>)
</code></pre></div><h3 id="scroll-1">Scroll</h3>
<p>The completed script can be downloaded <a href="https://github.com/alexherbo2/scroll.js">here</a>.</p>
<p>Based on <a href="https://key.saka.io">Saka Key</a>’s <a href="https://github.com/lusakasa/saka-key/tree/master/src/modes/command/client/commands/scroll">implementation</a>.</p>
<blockquote>
<p>Scrolls the selected element smoothly.  Works around the quirks of keydown events.
The first time a key is pressed (and held), a keydown event is fired immediately.
After that, there is a delay before the second keydown event is fired.
The third and all subsequent keydown events fire in rapid succession.
<a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/repeat"><code>event.repeat</code></a> is false for the first keydown event, but true for all others.
The delay (70 and 500) are carefully selected to keep scrolling smooth, but
prevent unexpected scrolling after the user has released the scroll key.
Relying on keyup events exclusively to stop scrolling is unreliable.</p>
</blockquote>
<p><code>scripts/scroll.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Scroll</span> {
  <span style="color:#a6e22e">constructor</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">scrollingElement</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">step</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">60</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">behavior</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;smooth&#39;</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">animation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>
  }
  <span style="color:#a6e22e">down</span>(<span style="color:#a6e22e">repeat</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">behavior</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;smooth&#39;</span>) {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">animate</span>(() =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollTop</span> <span style="color:#f92672">+=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">step</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>, <span style="color:#a6e22e">repeat</span>)
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">step</span> })
    }
  }
  <span style="color:#a6e22e">up</span>(<span style="color:#a6e22e">repeat</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">behavior</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;smooth&#39;</span>) {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">animate</span>(() =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollTop</span> <span style="color:#f92672">-=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">step</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>, <span style="color:#a6e22e">repeat</span>)
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">step</span> })
    }
  }
  <span style="color:#a6e22e">right</span>(<span style="color:#a6e22e">repeat</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">behavior</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;smooth&#39;</span>) {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">animate</span>(() =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollLeft</span> <span style="color:#f92672">+=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">step</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>, <span style="color:#a6e22e">repeat</span>)
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">left</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">step</span> })
    }
  }
  <span style="color:#a6e22e">left</span>(<span style="color:#a6e22e">repeat</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">behavior</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;smooth&#39;</span>) {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">animate</span>(() =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollLeft</span> <span style="color:#f92672">-=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">step</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>, <span style="color:#a6e22e">repeat</span>)
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">left</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">step</span> })
    }
  }
  <span style="color:#a6e22e">pageDown</span>(<span style="color:#a6e22e">percent</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.9</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> window.<span style="color:#a6e22e">innerHeight</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">percent</span>, <span style="color:#a6e22e">behavior</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">behavior</span> })
  }
  <span style="color:#a6e22e">pageUp</span>(<span style="color:#a6e22e">percent</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.9</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollBy</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span>window.<span style="color:#a6e22e">innerHeight</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">percent</span>, <span style="color:#a6e22e">behavior</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">behavior</span> })
  }
  <span style="color:#a6e22e">top</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollTo</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">behavior</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">behavior</span> })
  }
  <span style="color:#a6e22e">bottom</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollTo</span>({ <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollHeight</span>, <span style="color:#a6e22e">behavior</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">behavior</span> })
  }
  <span style="color:#a6e22e">animate</span>(<span style="color:#a6e22e">animation</span>, <span style="color:#a6e22e">repeat</span>) {
    <span style="color:#75715e">// Cancel potential animation being proceeded
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">cancelAnimationFrame</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">animation</span>)
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">delay</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">repeat</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">70</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">500</span>
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">step</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">timeStamp</span>) =&gt; {
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">start</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>) {
        <span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">timeStamp</span>
      }
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">progress</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">timeStamp</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">start</span>
      <span style="color:#a6e22e">animation</span>()
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">progress</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">delay</span>) {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">animation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">requestAnimationFrame</span>(<span style="color:#a6e22e">step</span>)
      } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">animation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>
      }
    }
    <span style="color:#a6e22e">requestAnimationFrame</span>(<span style="color:#a6e22e">step</span>)
  }
}
</code></pre></div><h4 id="smooth-scrolling">Smooth scrolling</h4>
<p>Update your configuration to smooth the scrolling.</p>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Tools ───────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">scroll</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Scroll</span>

<span style="color:#75715e">// Mappings ────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Scroll
</span><span style="color:#75715e"></span><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyJ&#39;</span>], (<span style="color:#a6e22e">event</span>) =&gt; <span style="color:#a6e22e">scroll</span>.<span style="color:#a6e22e">down</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">repeat</span>), <span style="color:#e6db74">&#39;Scroll down&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyK&#39;</span>], (<span style="color:#a6e22e">event</span>) =&gt; <span style="color:#a6e22e">scroll</span>.<span style="color:#a6e22e">up</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">repeat</span>), <span style="color:#e6db74">&#39;Scroll up&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyL&#39;</span>], (<span style="color:#a6e22e">event</span>) =&gt; <span style="color:#a6e22e">scroll</span>.<span style="color:#a6e22e">right</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">repeat</span>), <span style="color:#e6db74">&#39;Scroll right&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyH&#39;</span>], (<span style="color:#a6e22e">event</span>) =&gt; <span style="color:#a6e22e">scroll</span>.<span style="color:#a6e22e">left</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">repeat</span>), <span style="color:#e6db74">&#39;Scroll left&#39;</span>)

<span style="color:#75715e">// Scroll faster
</span><span style="color:#75715e"></span><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyJ&#39;</span>], () =&gt; <span style="color:#a6e22e">scroll</span>.<span style="color:#a6e22e">pageDown</span>(), <span style="color:#e6db74">&#39;Scroll page down&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyK&#39;</span>], () =&gt; <span style="color:#a6e22e">scroll</span>.<span style="color:#a6e22e">pageUp</span>(), <span style="color:#e6db74">&#39;Scroll page up&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyG&#39;</span>], () =&gt; <span style="color:#a6e22e">scroll</span>.<span style="color:#a6e22e">top</span>(), <span style="color:#e6db74">&#39;Scroll to the top of the page&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyG&#39;</span>], () =&gt; <span style="color:#a6e22e">scroll</span>.<span style="color:#a6e22e">bottom</span>(), <span style="color:#e6db74">&#39;Scroll to the bottom of the page&#39;</span>)
</code></pre></div><h3 id="player">Player</h3>
<p>The completed script can be downloaded <a href="https://github.com/alexherbo2/player.js">here</a>.</p>
<p><code>scripts/player.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Player</span> {
  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">media</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">media</span>
  }
  <span style="color:#a6e22e">fullscreen</span>() {
    <span style="color:#66d9ef">if</span> (document.<span style="color:#a6e22e">fullscreenElement</span>) {
      document.<span style="color:#a6e22e">exitFullscreen</span>()
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">requestFullscreen</span>()
    }
  }
  <span style="color:#a6e22e">pictureInPicture</span>() {
    <span style="color:#66d9ef">if</span> (document.<span style="color:#a6e22e">pictureInPictureElement</span>) {
      document.<span style="color:#a6e22e">exitPictureInPicture</span>()
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">requestPictureInPicture</span>()
    }
  }
  <span style="color:#a6e22e">pause</span>() {
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">paused</span>) {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">play</span>()
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">pause</span>()
    }
  }
  <span style="color:#a6e22e">seekRelative</span>(<span style="color:#a6e22e">seconds</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">currentTime</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">seconds</span>
  }
  <span style="color:#a6e22e">seekAbsolute</span>(<span style="color:#a6e22e">seconds</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">currentTime</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">seconds</span>
  }
  <span style="color:#a6e22e">seekAbsolutePercent</span>(<span style="color:#a6e22e">percent</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">currentTime</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">duration</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">percent</span>
  }
  <span style="color:#a6e22e">seekRelativePercent</span>(<span style="color:#a6e22e">percent</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">currentTime</span> <span style="color:#f92672">+=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">duration</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">percent</span>
  }
  <span style="color:#a6e22e">mute</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">muted</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">muted</span>
  }
  <span style="color:#a6e22e">setVolume</span>(<span style="color:#a6e22e">percent</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">volume</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>
  }
  <span style="color:#a6e22e">increaseVolume</span>(<span style="color:#a6e22e">percent</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">volume</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">volume</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">percent</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">volume</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">volume</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>
      <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span>
      <span style="color:#f92672">:</span> <span style="color:#a6e22e">volume</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>
      <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span>
      <span style="color:#f92672">:</span> <span style="color:#a6e22e">volume</span>
  }
  <span style="color:#a6e22e">descreaseVolume</span>(<span style="color:#a6e22e">percent</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">increaseVolume</span>(<span style="color:#f92672">-</span><span style="color:#a6e22e">percent</span>)
  }
}
</code></pre></div><h4 id="video-context">Video context</h4>
<p>Update your configuration to add a context for videos.</p>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">enable</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, <span style="color:#e6db74">&#39;Link&#39;</span>, <span style="color:#e6db74">&#39;Text&#39;</span>, <span style="color:#e6db74">&#39;Command&#39;</span>)

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">player</span> <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">media</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Modal</span>.<span style="color:#a6e22e">findParent</span>((<span style="color:#a6e22e">element</span>) =&gt; <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;video&#39;</span>))
  <span style="color:#a6e22e">Mouse</span>.<span style="color:#a6e22e">hover</span>(<span style="color:#a6e22e">media</span>)
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Player</span>(<span style="color:#a6e22e">media</span>)
}

<span style="color:#75715e">// Player
</span><span style="color:#75715e"></span><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, [<span style="color:#e6db74">&#39;Space&#39;</span>], () =&gt; <span style="color:#a6e22e">player</span>().<span style="color:#a6e22e">pause</span>(), <span style="color:#e6db74">&#39;Pause video&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, [<span style="color:#e6db74">&#39;KeyM&#39;</span>], () =&gt; <span style="color:#a6e22e">player</span>().<span style="color:#a6e22e">mute</span>(), <span style="color:#e6db74">&#39;Mute video&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, [<span style="color:#e6db74">&#39;KeyL&#39;</span>], () =&gt; <span style="color:#a6e22e">player</span>().<span style="color:#a6e22e">seekRelative</span>(<span style="color:#ae81ff">5</span>), <span style="color:#e6db74">&#39;Seek forward 5 seconds&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, [<span style="color:#e6db74">&#39;KeyH&#39;</span>], () =&gt; <span style="color:#a6e22e">player</span>().<span style="color:#a6e22e">seekRelative</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>), <span style="color:#e6db74">&#39;Seek backward 5 seconds&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, [<span style="color:#e6db74">&#39;KeyG&#39;</span>], () =&gt; <span style="color:#a6e22e">player</span>().<span style="color:#a6e22e">seekAbsolutePercent</span>(<span style="color:#ae81ff">0</span>), <span style="color:#e6db74">&#39;Seek to the beginning&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyG&#39;</span>], () =&gt; <span style="color:#a6e22e">player</span>().<span style="color:#a6e22e">seekAbsolutePercent</span>(<span style="color:#ae81ff">1</span>), <span style="color:#e6db74">&#39;Seek to the end&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, [<span style="color:#e6db74">&#39;KeyK&#39;</span>], () =&gt; <span style="color:#a6e22e">player</span>().<span style="color:#a6e22e">increaseVolume</span>(<span style="color:#ae81ff">0.1</span>), <span style="color:#e6db74">&#39;Increase volume&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, [<span style="color:#e6db74">&#39;KeyJ&#39;</span>], () =&gt; <span style="color:#a6e22e">player</span>().<span style="color:#a6e22e">decreaseVolume</span>(<span style="color:#ae81ff">0.1</span>), <span style="color:#e6db74">&#39;Decrease volume&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, [<span style="color:#e6db74">&#39;KeyF&#39;</span>], () =&gt; <span style="color:#a6e22e">player</span>().<span style="color:#a6e22e">fullscreen</span>(), <span style="color:#e6db74">&#39;Toggle full-screen mode&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, [<span style="color:#e6db74">&#39;KeyP&#39;</span>], () =&gt; <span style="color:#a6e22e">player</span>().<span style="color:#a6e22e">pictureInPicture</span>(), <span style="color:#e6db74">&#39;Toggle picture-in-picture mode&#39;</span>)
</code></pre></div><h2 id="part-4-multiple-selections">Part 4: Multiple selections</h2>
<p>The completed script can be downloaded <a href="https://github.com/alexherbo2/selection.js">here</a>.</p>
<h3 id="overview-1">Overview</h3>
<p><a href="https://youtu.be/KIsOSIQXAVU"><img src="https://img.youtube.com/vi_webp/KIsOSIQXAVU/maxresdefault.webp" alt="Selection demo"></a></p>
<p><strong>Motivation</strong> – Improving on the hinting model</p>
<blockquote>
<p>vi basic grammar is <strong>verb</strong> followed by <strong>object</strong>; it’s nice because it
matches well with the order we use in English, “delete word”.  On the other
hand, it does not match well with the nature of what we express: there is only
a handful of <strong>verbs</strong> in text editing (<strong>d</strong>elete, <strong>y</strong>ank, <strong>p</strong>aste,
<strong>i</strong>nsert…), and they don’t compose, contrarily to <strong>objects</strong> which can be
arbitrarily complex, and difficult to express.  That means that errors are not
handled well.  If you express your object wrongly with a delete verb, the wrong
text will get deleted, you will need to undo, and try again.</p>
<p>Kakoune’s grammar is <strong>object</strong> followed by <strong>verb</strong>, combined with instantaneous
feedback, that means you always see the current object (in Kakoune we call that
the selection) before you apply your change, which allows you to correct errors
on the go.</p>
<p>Kakoune tries hard to fix one of the big problems with the vi model: its lack
of interactivity.  Because of the <strong>verb</strong> followed by <strong>object</strong> grammar, vi
changes are made in the dark, we don’t see their effect until the whole editing
sentence is finished.  <code>5dw</code> will delete to next five words, if you then realize
that was one word too many, you need to undo, go back to your initial position,
and try again with <code>4dw</code>.  In Kakoune, you would do <code>5W</code>, see immediately that
one more word than expected was selected, type <code>BH</code> to remove that word from
the selection, then <code>d</code> to delete.  At each step you get visual feedback, and
have the opportunity to correct it.</p>
<p>(<a href="https://kakoune.org/why-kakoune/why-kakoune.html">Why Kakoune</a> – <a href="https://kakoune.org/why-kakoune/why-kakoune.html#_improving_on_the_editing_model">Improving on the editing model</a>)</p>
</blockquote>
<p><strong>Example</strong> – Manipulating selections on <a href="https://kakoune.org">Kakoune</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">selections</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SelectionList</span>

<span style="color:#75715e">// Getting Started
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getStarted</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;a[href*=&#34;getting-started&#34;]&#39;</span>)

<span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">getStarted</span>) <span style="color:#75715e">// Select “Getting Started”
</span><span style="color:#75715e"></span><span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">parent</span>(<span style="color:#ae81ff">2</span>) <span style="color:#75715e">// Select the navigation section
</span><span style="color:#75715e"></span><span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#75715e">// Select all links
</span><span style="color:#75715e"></span><span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">focus</span>(<span style="color:#a6e22e">getStarted</span>) <span style="color:#75715e">// Select “Getting Started”
</span><span style="color:#75715e"></span><span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">next</span>(<span style="color:#ae81ff">2</span>) <span style="color:#75715e">// Select “Issue Tracker”
</span><span style="color:#75715e"></span><span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">children</span>() <span style="color:#75715e">// Select all of the child elements
</span><span style="color:#75715e"></span><span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">previous</span>() <span style="color:#75715e">// Select the bug icon
</span><span style="color:#75715e"></span><span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">remove</span>() <span style="color:#75715e">// Remove the element from the selections
</span></code></pre></div><h3 id="the-prototype-1">The Prototype</h3>
<p>Create the files and update your configuration.</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">constructor</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span> <span style="color:#f92672">=</span> []
  }
  <span style="color:#a6e22e">get</span> <span style="color:#a6e22e">length</span>() {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">length</span>
  }
  <span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">callback</span>) {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">callback</span>)
  }
  <span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">element</span>) {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">element</span>)
  }
  <span style="color:#a6e22e">add</span>(...<span style="color:#a6e22e">elements</span>) {
  }
  <span style="color:#a6e22e">remove</span>(...<span style="color:#a6e22e">elements</span>) {
  }
  <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">callback</span>) {
  }
  <span style="color:#a6e22e">parent</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
  }
  <span style="color:#a6e22e">children</span>(<span style="color:#a6e22e">depth</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
  }
  <span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">selectors</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;*&#39;</span>) {
  }
  <span style="color:#a6e22e">focus</span>(<span style="color:#a6e22e">element</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>]) {
  }
  <span style="color:#a6e22e">next</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
  }
  <span style="color:#a6e22e">previous</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
  }
  <span style="color:#a6e22e">clear</span>() {
  }
}
</code></pre></div><p><code>styles/selection.css</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#75715e">/* Dracula theme – https://draculatheme.com */</span>

.<span style="color:#a6e22e">primary-selection</span> {
  <span style="color:#66d9ef">outline</span>: hsl(<span style="color:#ae81ff">326</span>, <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">74</span><span style="color:#66d9ef">%</span>) <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">medium</span> <span style="color:#75715e">!important</span>; <span style="color:#75715e">/* Pink */</span>
}

.<span style="color:#a6e22e">secondary-selection</span> {
  <span style="color:#66d9ef">outline</span>: hsl(<span style="color:#ae81ff">265</span>, <span style="color:#ae81ff">89</span><span style="color:#66d9ef">%</span>, <span style="color:#ae81ff">78</span><span style="color:#66d9ef">%</span>) <span style="color:#66d9ef">dotted</span> <span style="color:#66d9ef">thin</span> <span style="color:#75715e">!important</span>; <span style="color:#75715e">/* Purple */</span>
}
</code></pre></div><h3 id="implementation">Implementation</h3>
<p><strong>SelectionList</strong> is a collection of <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element">elements</a>.</p>
<p>When manipulating selections, we need to ensure selections are sorted and
overlapping selections merged.</p>
<p>Sorting is the easy part.  We can rely on <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/compareDocumentPosition">Node.compareDocumentPosition</a> to sort
the selections by their position in the document.</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">sort</span>() {
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>) {
      <span style="color:#66d9ef">return</span>
    }
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>]
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">sort</span>(<span style="color:#a6e22e">SelectionList</span>.<span style="color:#a6e22e">compare</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#a6e22e">main</span>)
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">compare</span>(<span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">other</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">compareDocumentPosition</span>(<span style="color:#a6e22e">other</span>) <span style="color:#f92672">&amp;</span> <span style="color:#a6e22e">Node</span>.<span style="color:#a6e22e">DOCUMENT_POSITION_FOLLOWING</span>) {
      <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
    }
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">compareDocumentPosition</span>(<span style="color:#a6e22e">other</span>) <span style="color:#f92672">&amp;</span> <span style="color:#a6e22e">Node</span>.<span style="color:#a6e22e">DOCUMENT_POSITION_PRECEDING</span>) {
      <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>
    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
  }
}
</code></pre></div><p>Merging is a bit more tricky.  We assume to work on sorted selections.</p>
<p>A parent element is always positioned first to its child elements.
The first element of the collection is therefore always valid.</p>
<p>The strategy will be to iterate over the collection while comparing a valid element
to the next candidates.</p>
<p>An element is valid when it is not the same than the previously validated element
or contained by it.  When these conditions are met, we push the previously validated
element to our new collection and update the target to the index the candidate had.</p>
<p>We also keep track of the main index during the process.</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">merge</span>() {
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>) {
      <span style="color:#66d9ef">return</span>
    }
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">collection</span> <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">target</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">candidate</span>
    <span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">candidate</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">candidate</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">candidate</span>) {
      <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">target</span>] <span style="color:#f92672">===</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">candidate</span>] <span style="color:#f92672">||</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">target</span>].<span style="color:#a6e22e">contains</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">candidate</span>])) {
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">candidate</span> <span style="color:#f92672">&lt;=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>) {
          <span style="color:#f92672">--</span><span style="color:#a6e22e">main</span>
        }
        <span style="color:#66d9ef">continue</span>
      }
      <span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">push</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">target</span>])
      <span style="color:#a6e22e">target</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">candidate</span>
    }
    <span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">push</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">target</span>])
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">main</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">collection</span>
  }
}
</code></pre></div><p>Keeping track of the main selection has its tricks too.</p>
<p>Here is the function I use to modify a selection set, and keep track of the main selection.</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">fold</span>(<span style="color:#a6e22e">callback</span>) {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">collection</span> <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">element</span>] <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">entries</span>()) {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">elements</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">callback</span>(<span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">index</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>)
      <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">length</span>) {
        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>
          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">index</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span> <span style="color:#f92672">||</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) {
            <span style="color:#f92672">--</span><span style="color:#a6e22e">main</span>
          }
          <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
          <span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">elements</span>[<span style="color:#ae81ff">0</span>])
          <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
          <span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">push</span>(...<span style="color:#a6e22e">elements</span>)
          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">index</span> <span style="color:#f92672">&lt;=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>) {
            <span style="color:#a6e22e">main</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
          }
      }
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">collection</span>, <span style="color:#a6e22e">main</span>)
  }
}
</code></pre></div><p>We can now implement the method to set the selections.</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">collection</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>, <span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">clear</span>()
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">main</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">main</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
      <span style="color:#f92672">?</span> <span style="color:#a6e22e">main</span>
      <span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">collection</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">sort</span>()
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">merge</span>()
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">render</span>()
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">focus</span>()
  }
  <span style="color:#a6e22e">render</span>() {
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#66d9ef">return</span>
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>].<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;primary-selection&#39;</span>)
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">element</span>] <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">entries</span>()) {
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">index</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>) {
        <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;secondary-selection&#39;</span>)
      }
    }
  }
  <span style="color:#a6e22e">clear</span>() {
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#66d9ef">return</span>
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>].<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#e6db74">&#39;primary-selection&#39;</span>)
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">element</span>] <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">entries</span>()) {
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">index</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>) {
        <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#e6db74">&#39;secondary-selection&#39;</span>)
      }
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span> <span style="color:#f92672">=</span> []
  }
}
</code></pre></div><p>Adding and removing elements:</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">add</span>(...<span style="color:#a6e22e">elements</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">collection</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">elements</span>)
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">collection</span>, <span style="color:#a6e22e">main</span>)
  }
  <span style="color:#a6e22e">remove</span>(...<span style="color:#a6e22e">elements</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">collection</span> <span style="color:#f92672">=</span> Object.<span style="color:#a6e22e">assign</span>([<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>]], <span style="color:#a6e22e">elements</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">candidate</span>) =&gt; <span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">candidate</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">false</span>)
  }
}
</code></pre></div><p>Filtering selections:</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">callback</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fold</span>((<span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">array</span>) =&gt; <span style="color:#a6e22e">callback</span>(<span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">array</span>) <span style="color:#f92672">?</span> [<span style="color:#a6e22e">element</span>] <span style="color:#f92672">:</span> [])
  }
}
</code></pre></div><p>Skim through the selection list:</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">focus</span>(<span style="color:#a6e22e">element</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>]) {
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#66d9ef">return</span>
    }
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#a6e22e">element</span>)
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">main</span> <span style="color:#f92672">===</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
      <span style="color:#66d9ef">return</span>
    }
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">main</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>) {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">secondary</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span>]
      <span style="color:#a6e22e">secondary</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#e6db74">&#39;primary-selection&#39;</span>)
      <span style="color:#a6e22e">secondary</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;secondary-selection&#39;</span>)
      <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#e6db74">&#39;secondary-selection&#39;</span>)
      <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;primary-selection&#39;</span>)
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">main</span>
    }
    <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">focus</span>()
    <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">scrollIntoView</span>({ <span style="color:#a6e22e">block</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;nearest&#39;</span> })
  }
  <span style="color:#a6e22e">next</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SelectionList</span>.<span style="color:#a6e22e">modulo</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">main</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">count</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">focus</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">main</span>])
  }
  <span style="color:#a6e22e">previous</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">next</span>(<span style="color:#f92672">-</span><span style="color:#a6e22e">count</span>)
  }
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">modulo</span>(<span style="color:#a6e22e">dividend</span>, <span style="color:#a6e22e">divisor</span>) {
    <span style="color:#66d9ef">return</span> ((<span style="color:#a6e22e">dividend</span> <span style="color:#f92672">%</span> <span style="color:#a6e22e">divisor</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">divisor</span>) <span style="color:#f92672">%</span> <span style="color:#a6e22e">divisor</span>
  }
}
</code></pre></div><p>Select parents:</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">parent</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getParent</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">count</span>) =&gt; {
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">count</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span>) {
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">element</span>
      }
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">element</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>) {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>
      }
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">getParent</span>(<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">parentElement</span>, <span style="color:#a6e22e">count</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fold</span>((<span style="color:#a6e22e">element</span>) =&gt; {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">getParent</span>(<span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">count</span>)
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">parent</span> <span style="color:#f92672">?</span> [<span style="color:#a6e22e">parent</span>] <span style="color:#f92672">:</span> []
    })
  }
}
</code></pre></div><p>Select all of the child elements:</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">children</span>(<span style="color:#a6e22e">depth</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">depth</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">||</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#66d9ef">return</span>
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fold</span>((<span style="color:#a6e22e">element</span>) =&gt; <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">children</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">children</span>(<span style="color:#a6e22e">depth</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
  }
}
</code></pre></div><p>Select elements:</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">selectors</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;*&#39;</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fold</span>((<span style="color:#a6e22e">element</span>) =&gt; Array.<span style="color:#a6e22e">from</span>(<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#a6e22e">selectors</span>)))
  }
}
</code></pre></div><p>Adding events:</p>
<p><code>scripts/selection.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SelectionList</span> {
  <span style="color:#a6e22e">constructor</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span> <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#e6db74">&#39;selection-change&#39;</span>] <span style="color:#f92672">=</span> []
  }
  <span style="color:#a6e22e">on</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">listener</span>) {
  }
  <span style="color:#a6e22e">triggerEvent</span>(<span style="color:#a6e22e">type</span>, ...<span style="color:#a6e22e">parameters</span>) {
  }
  <span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">collection</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>, <span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;selection-change&#39;</span>, <span style="color:#a6e22e">collection</span>)
  }
  <span style="color:#a6e22e">clear</span>() {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;selection-change&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">collection</span>)
  }
}
</code></pre></div><h3 id="configuration-1">Configuration</h3>
<p>Create an instance of <strong>SelectionList</strong>.</p>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">selections</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SelectionList</span>
</code></pre></div><h4 id="selection-manipulation">Selection manipulation</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keep</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">selections</span>, <span style="color:#a6e22e">matching</span>, ...<span style="color:#a6e22e">attributes</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">matching</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;Keep matching&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Keep not matching&#39;</span>
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">prompt</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">mode</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> (</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">attributes</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)`</span>)
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">value</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>) {
    <span style="color:#66d9ef">return</span>
  }
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">regex</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RegExp(<span style="color:#a6e22e">value</span>)
  <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">selection</span>) =&gt; <span style="color:#a6e22e">attributes</span>.<span style="color:#a6e22e">some</span>((<span style="color:#a6e22e">attribute</span>) =&gt; <span style="color:#a6e22e">regex</span>.<span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">selection</span>[<span style="color:#a6e22e">attribute</span>]) <span style="color:#f92672">===</span> <span style="color:#a6e22e">matching</span>))
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">select</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">selections</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">prompt</span>(<span style="color:#e6db74">&#39;Select (querySelectorAll)&#39;</span>)
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">value</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>) {
    <span style="color:#66d9ef">return</span>
  }
  <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">value</span>)
}

<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyS&#39;</span>], () =&gt; <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">add</span>(document.<span style="color:#a6e22e">activeElement</span>), <span style="color:#e6db74">&#39;Select active element&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyS&#39;</span>], () =&gt; <span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">selections</span>), <span style="color:#e6db74">&#39;Select elements that match the specified group of selectors&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;Digit5&#39;</span>], () =&gt; <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">set</span>([document.<span style="color:#a6e22e">documentElement</span>]), <span style="color:#e6db74">&#39;Select document&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;Digit0&#39;</span>], () =&gt; <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">next</span>(), <span style="color:#e6db74">&#39;Focus next selection&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;Digit9&#39;</span>], () =&gt; <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">previous</span>(), <span style="color:#e6db74">&#39;Focus previous selection&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Space&#39;</span>], () =&gt; <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">clear</span>(), <span style="color:#e6db74">&#39;Clear selections&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Control&#39;</span>, <span style="color:#e6db74">&#39;Space&#39;</span>], () =&gt; <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">focus</span>(), <span style="color:#e6db74">&#39;Focus main selection&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Space&#39;</span>], () =&gt; <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">remove</span>(), <span style="color:#e6db74">&#39;Remove main selection&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyA&#39;</span>], () =&gt; <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">parent</span>(), <span style="color:#e6db74">&#39;Select parent elements&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyI&#39;</span>], () =&gt; <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">children</span>(), <span style="color:#e6db74">&#39;Select child elements&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyI&#39;</span>], () =&gt; <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#39;a&#39;</span>), <span style="color:#e6db74">&#39;Select links&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyK&#39;</span>], () =&gt; <span style="color:#a6e22e">keep</span>(<span style="color:#a6e22e">selections</span>, <span style="color:#66d9ef">true</span>, <span style="color:#e6db74">&#39;textContent&#39;</span>), <span style="color:#e6db74">&#39;Keep selections that match the given RegExp&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyK&#39;</span>], () =&gt; <span style="color:#a6e22e">keep</span>(<span style="color:#a6e22e">selections</span>, <span style="color:#66d9ef">true</span>, <span style="color:#e6db74">&#39;href&#39;</span>), <span style="color:#e6db74">&#39;Keep links that match the given RegExp&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyJ&#39;</span>], () =&gt; <span style="color:#a6e22e">keep</span>(<span style="color:#a6e22e">selections</span>, <span style="color:#66d9ef">false</span>, <span style="color:#e6db74">&#39;textContent&#39;</span>), <span style="color:#e6db74">&#39;Clear selections that match the given RegExp&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyJ&#39;</span>], () =&gt; <span style="color:#a6e22e">keep</span>(<span style="color:#a6e22e">selections</span>, <span style="color:#66d9ef">false</span>, <span style="color:#e6db74">&#39;href&#39;</span>), <span style="color:#e6db74">&#39;Clear links that match the given RegExp&#39;</span>)
</code></pre></div><h4 id="link-hints">Link hints</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hint</span> <span style="color:#f92672">=</span> ({ <span style="color:#a6e22e">selections</span>, <span style="color:#a6e22e">selectors</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;*&#39;</span>, <span style="color:#a6e22e">lock</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span> } <span style="color:#f92672">=</span> {}) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hint</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Hint</span>
  <span style="color:#a6e22e">hint</span>.<span style="color:#a6e22e">selectors</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectors</span>
  <span style="color:#a6e22e">hint</span>.<span style="color:#a6e22e">lock</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">lock</span>
  <span style="color:#a6e22e">hint</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;validate&#39;</span>, (<span style="color:#a6e22e">target</span>) =&gt; {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">hint</span>.<span style="color:#a6e22e">lock</span>) {
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">target</span>)) {
        <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">target</span>)
      } <span style="color:#66d9ef">else</span> {
        <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">target</span>)
      }
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">focus</span>()
    }
  })
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hint</span>
}

<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyF&#39;</span>], () =&gt; <span style="color:#a6e22e">hint</span>({ <span style="color:#a6e22e">selections</span>, <span style="color:#a6e22e">lock</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }).<span style="color:#a6e22e">start</span>(), <span style="color:#e6db74">&#39;Select multiple links&#39;</span>)
</code></pre></div><h4 id="open-links">Open links</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">click</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">selections</span>, <span style="color:#a6e22e">modifierKeys</span> <span style="color:#f92672">=</span> {}) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">elements</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">includes</span>(document.<span style="color:#a6e22e">activeElement</span>)
    <span style="color:#f92672">?</span> <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">collection</span>
    <span style="color:#f92672">:</span> [document.<span style="color:#a6e22e">activeElement</span>]
  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">element</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">elements</span>) {
    <span style="color:#a6e22e">Mouse</span>.<span style="color:#a6e22e">click</span>(<span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">modifierKeys</span>)
  }
}

<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;Enter&#39;</span>], () =&gt; <span style="color:#a6e22e">click</span>(<span style="color:#a6e22e">selections</span>), <span style="color:#e6db74">&#39;Open link&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;Control&#39;</span>, <span style="color:#e6db74">&#39;Enter&#39;</span>], () =&gt; <span style="color:#a6e22e">click</span>(<span style="color:#a6e22e">selections</span>, { <span style="color:#a6e22e">ctrlKey</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }), <span style="color:#e6db74">&#39;Open link in new tab&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;Enter&#39;</span>], () =&gt; <span style="color:#a6e22e">click</span>(<span style="color:#a6e22e">selections</span>, { <span style="color:#a6e22e">shiftKey</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }), <span style="color:#e6db74">&#39;Open link in new window&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Enter&#39;</span>], () =&gt; <span style="color:#a6e22e">click</span>(<span style="color:#a6e22e">selections</span>, { <span style="color:#a6e22e">altKey</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }), <span style="color:#e6db74">&#39;Download link&#39;</span>)
</code></pre></div><h4 id="clipboard-1">Clipboard</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">yank</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">selections</span>, <span style="color:#a6e22e">callback</span>, <span style="color:#a6e22e">message</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">includes</span>(document.<span style="color:#a6e22e">activeElement</span>)
    <span style="color:#f92672">?</span> <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">callback</span>).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)
    <span style="color:#f92672">:</span> <span style="color:#a6e22e">callback</span>(document.<span style="color:#a6e22e">activeElement</span>)
  <span style="color:#a6e22e">copyToClipboard</span>(<span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">message</span>)
}

<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;KeyY&#39;</span>], () =&gt; <span style="color:#a6e22e">yank</span>(<span style="color:#a6e22e">selections</span>, (<span style="color:#a6e22e">selection</span>) =&gt; <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">href</span>, <span style="color:#e6db74">&#39;Link address copied&#39;</span>), <span style="color:#e6db74">&#39;Copy link address&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyY&#39;</span>], () =&gt; <span style="color:#a6e22e">yank</span>(<span style="color:#a6e22e">selections</span>, (<span style="color:#a6e22e">selection</span>) =&gt; <span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">textContent</span>, <span style="color:#e6db74">&#39;Link text copied&#39;</span>), <span style="color:#e6db74">&#39;Copy link text&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyY&#39;</span>], () =&gt; <span style="color:#a6e22e">yank</span>(<span style="color:#a6e22e">selections</span>, (<span style="color:#a6e22e">selection</span>) =&gt; <span style="color:#e6db74">`[</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">textContent</span><span style="color:#e6db74">}</span><span style="color:#e6db74">](</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">selection</span>.<span style="color:#a6e22e">href</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)`</span>, <span style="color:#e6db74">&#39;Link address and text copied&#39;</span>), <span style="color:#e6db74">&#39;Copy link address and text&#39;</span>)
</code></pre></div><h4 id="status-line-1">Status line</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">updateStatusLine</span> <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">notify</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;status-line&#39;</span>, <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> (</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">length</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)`</span> })
}

<span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;selection-change&#39;</span>, (<span style="color:#a6e22e">selections</span>) =&gt; <span style="color:#a6e22e">updateStatusLine</span>())
</code></pre></div><h2 id="part-5-polishment">Part 5: Polishment</h2>
<h3 id="custom-prompt">Custom prompt</h3>
<p>The completed extension can be downloaded <a href="https://github.com/alexherbo2/prompt.js">here</a>.</p>
<p><code>scripts/prompt.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Prompt</span> {
  <span style="color:#a6e22e">constructor</span>() {
    <span style="color:#75715e">// Events
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span> <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#e6db74">&#39;open&#39;</span>] <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#e6db74">&#39;close&#39;</span>] <span style="color:#f92672">=</span> []
    <span style="color:#75715e">// Style
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span><span style="color:#e6db74">      dialog {
</span><span style="color:#e6db74">        position: fixed;
</span><span style="color:#e6db74">        margin-right: 0;
</span><span style="color:#e6db74">        top: 0;
</span><span style="color:#e6db74">        right: 0;
</span><span style="color:#e6db74">        color: gray;
</span><span style="color:#e6db74">        background-color: white;
</span><span style="color:#e6db74">        border: 1px solid lightgray;
</span><span style="color:#e6db74">        border-bottom-left-radius: 4px;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">      input {
</span><span style="color:#e6db74">        font-family: serif;
</span><span style="color:#e6db74">        font-size: 18px;
</span><span style="color:#e6db74">        background-color: white;
</span><span style="color:#e6db74">        border: none;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">      input:focus {
</span><span style="color:#e6db74">        outline: none;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">    `</span>
  }
  <span style="color:#a6e22e">on</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">listener</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#a6e22e">type</span>].<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">listener</span>)
  }
  <span style="color:#a6e22e">triggerEvent</span>(<span style="color:#a6e22e">type</span>, ...<span style="color:#a6e22e">parameters</span>) {
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">listener</span> <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">events</span>[<span style="color:#a6e22e">type</span>]) {
      <span style="color:#a6e22e">listener</span>(...<span style="color:#a6e22e">parameters</span>)
    }
  }
  <span style="color:#a6e22e">fire</span>(<span style="color:#a6e22e">message</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dialog</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;dialog&#39;</span>)
    <span style="color:#66d9ef">switch</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">dialog</span>.<span style="color:#a6e22e">showModal</span>) {
      <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;function&#39;</span><span style="color:#f92672">:</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fireDialog</span>(<span style="color:#a6e22e">message</span>)
        <span style="color:#66d9ef">break</span>
      <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;undefined&#39;</span><span style="color:#f92672">:</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">firePrompt</span>(<span style="color:#a6e22e">message</span>)
        <span style="color:#66d9ef">break</span>
    }
  }
  <span style="color:#a6e22e">fireDialog</span>(<span style="color:#a6e22e">message</span>) {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>)
      <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;prompt&#39;</span>
      <span style="color:#75715e">// Place the prompt in a shadow root,
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// so that the prompt and page styles won’t affect each other.
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// Use an open shadow root to mitigate key-binding issues.
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// For example, sites can access the real active element with document.activeElement.shadowRoot.activeElement.
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shadow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">attachShadow</span>({ <span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;open&#39;</span> })
      <span style="color:#75715e">// Dialog
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dialog</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;dialog&#39;</span>)
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">form</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;form&#39;</span>)
      <span style="color:#a6e22e">form</span>.<span style="color:#a6e22e">method</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;dialog&#39;</span>
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">input</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;input&#39;</span>)
      <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">placeholder</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">message</span>
      <span style="color:#75715e">// Style
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;style&#39;</span>)
      <span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">style</span>
      <span style="color:#75715e">// Attach
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">style</span>)
      <span style="color:#a6e22e">shadow</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">dialog</span>).<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">form</span>).<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">input</span>)
      document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">root</span>)
      <span style="color:#75715e">// Show modal
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">dialog</span>.<span style="color:#a6e22e">showModal</span>()
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;open&#39;</span>)
      <span style="color:#75715e">// Events
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">dialog</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;close&#39;</span>, () =&gt; {
        <span style="color:#a6e22e">resolve</span>(<span style="color:#a6e22e">dialog</span>.<span style="color:#a6e22e">returnValue</span>)
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">triggerEvent</span>(<span style="color:#e6db74">&#39;close&#39;</span>)
      })
      <span style="color:#a6e22e">form</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;submit&#39;</span>, () =&gt; {
        <span style="color:#a6e22e">dialog</span>.<span style="color:#a6e22e">close</span>(<span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">value</span>)
      })
      <span style="color:#a6e22e">dialog</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;cancel&#39;</span>, () =&gt; {
        <span style="color:#a6e22e">dialog</span>.<span style="color:#a6e22e">close</span>(<span style="color:#66d9ef">null</span>)
      })
      <span style="color:#a6e22e">dialog</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;keydown&#39;</span>, (<span style="color:#a6e22e">event</span>) =&gt; {
        <span style="color:#75715e">// Stop the propagation of the event
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">stopImmediatePropagation</span>()
      })
    })
  }
  <span style="color:#a6e22e">firePrompt</span>(<span style="color:#a6e22e">message</span>) {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">prompt</span>(<span style="color:#a6e22e">message</span>)
      <span style="color:#a6e22e">resolve</span>(<span style="color:#a6e22e">value</span>)
    })
  }
}
</code></pre></div><p>Update your configuration.</p>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Prompt
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Prompt</span>
<span style="color:#a6e22e">prompt</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;open&#39;</span>, () =&gt; <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">unlisten</span>())
<span style="color:#a6e22e">prompt</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;close&#39;</span>, () =&gt; <span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">listen</span>())

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keep</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">selections</span>, <span style="color:#a6e22e">matching</span>, ...<span style="color:#a6e22e">attributes</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">matching</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;Keep matching&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Keep not matching&#39;</span>
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">prompt</span>.<span style="color:#a6e22e">fire</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">mode</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> (</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">attributes</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)`</span>)
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">value</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>) {
    <span style="color:#66d9ef">return</span>
  }
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">regex</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RegExp(<span style="color:#a6e22e">value</span>)
  <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">selection</span>) =&gt; <span style="color:#a6e22e">attributes</span>.<span style="color:#a6e22e">some</span>((<span style="color:#a6e22e">attribute</span>) =&gt; <span style="color:#a6e22e">regex</span>.<span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">selection</span>[<span style="color:#a6e22e">attribute</span>]) <span style="color:#f92672">===</span> <span style="color:#a6e22e">matching</span>))
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">select</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">selections</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">prompt</span>.<span style="color:#a6e22e">fire</span>(<span style="color:#e6db74">&#39;Select (querySelectorAll)&#39;</span>)
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">value</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>) {
    <span style="color:#66d9ef">return</span>
  }
  <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">value</span>)
}
</code></pre></div><h3 id="icons">Icons</h3>
<p>Add <a href="https://developer.chrome.com/extensions/manifest/icons">icons</a> for the extension.</p>
<p><code>manifest.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;icons&#34;</span>: {
    <span style="color:#f92672">&#34;16&#34;</span>: <span style="color:#e6db74">&#34;build/chrome.png&#34;</span>,
    <span style="color:#f92672">&#34;48&#34;</span>: <span style="color:#e6db74">&#34;build/chrome.png&#34;</span>,
    <span style="color:#f92672">&#34;128&#34;</span>: <span style="color:#e6db74">&#34;build/chrome.png&#34;</span>
  }
}
</code></pre></div><p><code>fetch</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">fetch <span style="color:#e6db74">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a5/Google_Chrome_icon_(September_2014).svg&#39;</span> chrome.svg
</code></pre></div><p><code>Makefile</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile"><span style="color:#a6e22e">build</span><span style="color:#f92672">:</span> fetch
	mkdir -p build
	inkscape --without-gui packages/chrome.svg --export-png build/chrome.png

<span style="color:#a6e22e">fetch</span><span style="color:#f92672">:</span>
	./fetch

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
	rm -Rf build packages

<span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> build fetch
</code></pre></div><p><code>.gitignore</code></p>
<pre><code class="language-gitignore" data-lang="gitignore">build
packages
</code></pre><h2 id="part-6-chrome-apis">Part 6: Chrome APIs</h2>
<p>The completed extension can be downloaded <a href="https://github.com/alexherbo2/chrome-commands">here</a>.</p>
<h3 id="new-extension">New extension</h3>
<p>Like in <a href="#getting-started">Getting Started</a>, create a new directory to hold the extension’s files.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir chrome-commands
cd chrome-commands
</code></pre></div><p><code>manifest.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;manifest_version&#34;</span>: <span style="color:#ae81ff">2</span>,
  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Commands&#34;</span>,
  <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Commands for Chrome&#34;</span>,
  <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0.1.0&#34;</span>,
  <span style="color:#f92672">&#34;permissions&#34;</span>: [
    <span style="color:#e6db74">&#34;sessions&#34;</span>,
    <span style="color:#e6db74">&#34;notifications&#34;</span>
  ],
  <span style="color:#f92672">&#34;background&#34;</span>: {
    <span style="color:#f92672">&#34;scripts&#34;</span>: [
      <span style="color:#e6db74">&#34;background.js&#34;</span>
    ],
    <span style="color:#f92672">&#34;persistent&#34;</span>: <span style="color:#66d9ef">false</span>
  },
  <span style="color:#f92672">&#34;icons&#34;</span>: {
    <span style="color:#f92672">&#34;16&#34;</span>: <span style="color:#e6db74">&#34;build/chrome.png&#34;</span>,
    <span style="color:#f92672">&#34;48&#34;</span>: <span style="color:#e6db74">&#34;build/chrome.png&#34;</span>,
    <span style="color:#f92672">&#34;128&#34;</span>: <span style="color:#e6db74">&#34;build/chrome.png&#34;</span>
  }
}
</code></pre></div><p>We will use the same <code>fetch</code> and Makefile scripts than preceding.</p>
<p>Create a <a href="https://developer.chrome.com/extensions/background_pages">background script</a> titled <code>background.js</code>.</p>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">commands</span> <span style="color:#f92672">=</span> {}
</code></pre></div><h3 id="commands">Commands</h3>
<h4 id="zoom">Zoom</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;zoom-in&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">step</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.1</span>) =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">getZoom</span>(<span style="color:#66d9ef">undefined</span>, (<span style="color:#a6e22e">zoomFactor</span>) =&gt; {
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">setZoom</span>(<span style="color:#66d9ef">undefined</span>, <span style="color:#a6e22e">zoomFactor</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">step</span>)
  })
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;zoom-out&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">step</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.1</span>) =&gt; {
  <span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;zoom-in&#39;</span>](<span style="color:#f92672">-</span><span style="color:#a6e22e">step</span>)
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;zoom-reset&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">setZoom</span>(<span style="color:#66d9ef">undefined</span>, <span style="color:#ae81ff">0</span>)
}
</code></pre></div><h4 id="create-tabs">Create tabs</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;new-tab&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">url</span>) =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">create</span>({ <span style="color:#a6e22e">url</span> })
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;restore-tab&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">sessions</span>.<span style="color:#a6e22e">restore</span>()
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;duplicate-tab&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">tab</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">duplicate</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>)
  })
}
</code></pre></div><h4 id="create-windows">Create windows</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;new-window&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">url</span>) =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">windows</span>.<span style="color:#a6e22e">create</span>({ <span style="color:#a6e22e">url</span> })
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;new-incognito-window&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">windows</span>.<span style="color:#a6e22e">create</span>({ <span style="color:#a6e22e">incognito</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> })
}
</code></pre></div><h4 id="close-tabs">Close tabs</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;close-tab&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">tab</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>)
  })
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;close-other-tabs&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tab</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">tabs</span>) {
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">active</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">false</span>) {
        <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>)
      }
    }
  })
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;close-right-tabs&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">active</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">find</span>((<span style="color:#a6e22e">tab</span>) =&gt; <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">active</span>)
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rightTabs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">active</span>.<span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tab</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">rightTabs</span>) {
      <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>)
    }
  })
}
</code></pre></div><h4 id="refresh-tabs">Refresh tabs</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;reload-tab&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">bypassCache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>) =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">reload</span>(<span style="color:#66d9ef">undefined</span>, { <span style="color:#a6e22e">bypassCache</span> })
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;reload-all-tabs&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">bypassCache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>) =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({}, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tab</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">tabs</span>) {
      <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">reload</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">bypassCache</span> })
    }
  })
}
</code></pre></div><h4 id="switch-tabs">Switch tabs</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;next-tab&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">active</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">find</span>((<span style="color:#a6e22e">tab</span>) =&gt; <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">active</span>)
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">next</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>[<span style="color:#a6e22e">modulo</span>(<span style="color:#a6e22e">active</span>.<span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">length</span>)]
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">next</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> })
  })
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;previous-tab&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) =&gt; {
  <span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;next-tab&#39;</span>](<span style="color:#f92672">-</span><span style="color:#a6e22e">count</span>)
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;first-tab&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">first</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>[<span style="color:#ae81ff">0</span>]
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">first</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> })
  })
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;last-tab&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">last</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>[<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">last</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> })
  })
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">modulo</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">dividend</span>, <span style="color:#a6e22e">divisor</span>) =&gt; {
  <span style="color:#66d9ef">return</span> ((<span style="color:#a6e22e">dividend</span> <span style="color:#f92672">%</span> <span style="color:#a6e22e">divisor</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">divisor</span>) <span style="color:#f92672">%</span> <span style="color:#a6e22e">divisor</span>
}
</code></pre></div><h4 id="move-tabs">Move tabs</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;move-tab-right&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">active</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">find</span>((<span style="color:#a6e22e">tab</span>) =&gt; <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">active</span>)
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">next</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>[<span style="color:#a6e22e">modulo</span>(<span style="color:#a6e22e">active</span>.<span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">length</span>)]
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">move</span>(<span style="color:#a6e22e">active</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">index</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">next</span>.<span style="color:#a6e22e">index</span> })
  })
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;move-tab-left&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">count</span>) =&gt; {
  <span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;move-tab-right&#39;</span>](<span style="color:#f92672">-</span><span style="color:#a6e22e">count</span>)
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;move-tab-first&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">tab</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">move</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">index</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span> })
  })
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;move-tab-last&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">tab</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">move</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">index</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> })
  })
}
</code></pre></div><h4 id="detach-tabs">Detach tabs</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;detach-tab&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">tab</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pinned</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">pinned</span>
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">windows</span>.<span style="color:#a6e22e">create</span>({ <span style="color:#a6e22e">tabId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span> }, (window) =&gt; {
      <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">pinned</span> })
    })
  })
}

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;attach-tab&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">tab</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pinned</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">pinned</span>
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">windowId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">focusedWindows</span>[<span style="color:#a6e22e">focusedWindows</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>] }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">target</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">find</span>((<span style="color:#a6e22e">tab</span>) =&gt; <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">active</span>)
      <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">move</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">windowId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">windowId</span>, <span style="color:#a6e22e">index</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">modulo</span>(<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) }, (<span style="color:#a6e22e">tab</span>) =&gt; {
        <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">pinned</span> })
      })
    })
  })
}

<span style="color:#75715e">// Events ──────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">focusedWindows</span> <span style="color:#f92672">=</span> []

<span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">windows</span>.<span style="color:#a6e22e">onFocusChanged</span>.<span style="color:#a6e22e">addListener</span>((<span style="color:#a6e22e">id</span>) =&gt; {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">id</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">windows</span>.<span style="color:#a6e22e">WINDOW_ID_NONE</span>) {
    <span style="color:#a6e22e">focusedWindows</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">id</span>)
  }
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">focusedWindows</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>) {
    <span style="color:#a6e22e">focusedWindows</span>.<span style="color:#a6e22e">shift</span>()
  }
})
</code></pre></div><h4 id="discard-tabs">Discard tabs</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;discard-tab&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">tab</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">discard</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>)
  })
}
</code></pre></div><h4 id="mute-tabs">Mute tabs</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;mute-tab&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">tab</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">muted</span><span style="color:#f92672">:</span> <span style="color:#f92672">!</span> <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">mutedInfo</span>.<span style="color:#a6e22e">muted</span> })
  })
}

<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">muted</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>

<span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;mute-all-tabs&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">muted</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span> <span style="color:#a6e22e">muted</span>
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({}, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tab</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">tabs</span>) {
      <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">muted</span> })
    }
  })
}
</code></pre></div><h4 id="pin-tabs">Pin tabs</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;pin-tab&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">currentWindow</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">tab</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">pinned</span><span style="color:#f92672">:</span> <span style="color:#f92672">!</span> <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">pinned</span> })
  })
}
</code></pre></div><h4 id="notifications-1">Notifications</h4>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">commands</span>[<span style="color:#e6db74">&#39;notify&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">options</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">properties</span> <span style="color:#f92672">=</span> {}
  <span style="color:#a6e22e">properties</span>.<span style="color:#a6e22e">title</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
  <span style="color:#a6e22e">properties</span>.<span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
  <span style="color:#a6e22e">properties</span>.<span style="color:#a6e22e">type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;basic&#39;</span>
  <span style="color:#a6e22e">properties</span>.<span style="color:#a6e22e">iconUrl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;packages/chrome.svg&#39;</span>
  Object.<span style="color:#a6e22e">assign</span>(<span style="color:#a6e22e">properties</span>, <span style="color:#a6e22e">options</span>)
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">notifications</span>.<span style="color:#a6e22e">getAll</span>((<span style="color:#a6e22e">notifications</span>) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">notification</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">notifications</span>[<span style="color:#a6e22e">id</span>]
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">notification</span>) {
      <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">notifications</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">properties</span>)
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">notifications</span>.<span style="color:#a6e22e">create</span>(<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">properties</span>)
    }
  })
}
</code></pre></div><h3 id="initialization">Initialization</h3>
<p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">onConnectExternal</span>.<span style="color:#a6e22e">addListener</span>((<span style="color:#a6e22e">port</span>) =&gt; {
  <span style="color:#a6e22e">port</span>.<span style="color:#a6e22e">onMessage</span>.<span style="color:#a6e22e">addListener</span>((<span style="color:#a6e22e">request</span>) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">command</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">commands</span>[<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">command</span>]
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arguments</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">arguments</span> <span style="color:#f92672">||</span> []
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">command</span>) {
      <span style="color:#a6e22e">command</span>(...<span style="color:#a6e22e">arguments</span>)
    }
  })
})
</code></pre></div><h3 id="configuration-2">Configuration</h3>
<p>Assign a <a href="https://developer.chrome.com/extensions/manifest/key">key</a> to the extension to have a stable extension ID.</p>
<ul>
<li>
<p>If you haven’t uploaded the extension yet, you can get a suitable key value
by looking in your <a href="https://chromium.googlesource.com/chromium/src/+/master/docs/user_data_dir.md">user data directory</a> <code>Default/Extensions/&lt;extension-id&gt;/&lt;version-string&gt;/manifest.json</code>.
You will see the key value filled in there.</p>
</li>
<li>
<p>If you already uploaded the extension, you can get the key value in the <a href="https://chrome.google.com/webstore/developer/dashboard">Chrome Developer Dashboard</a>
by clicking on <em>Extension</em> ❯ <em>More info</em> ❯ <em>Public key</em>.</p>
</li>
</ul>
<p><code>manifest.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">Extension</span> <span style="color:#960050;background-color:#1e0010">ID:</span> <span style="color:#960050;background-color:#1e0010">cabmgmngameccclicfmcpffnbinnmopc</span>
  <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAl7hfbL55fip9+2aqoPQmb8n3BLkhpqPR+oHHsU/vLDC1c8wb+CbmD7Gk2VlCWp0R8b0DDdDpcVgMEvoKkagXsfhOjW7zFG1bh6O4nUOZhzNkEVCZjWMewBE0FnJ74EE8Sz1jQJKqO8AiNiLZNpH6gkiG25CNVUg1bZAKFuqZQ1YNL9fw9EnI13oIetO0+gtkgNY8Rt3WCr+J74oD3Ox10f43Fj/8rF6x8mOfTu1D89MXIYXnN/ssPOZpzee+M0QoWUsS7dduuYDCQA/YjwKYgkZz5fX96ZC1Djwb4HE0Q9ijvTuA7YctEFHqL0KLyeUItCisElVa3cEnAfRWxjjahwIDAQAB&#34;</span>
}
</code></pre></div><p>Connect your configuration to the extension.</p>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">commands</span> <span style="color:#f92672">=</span> {}
<span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">connect</span>(<span style="color:#e6db74">&#39;cabmgmngameccclicfmcpffnbinnmopc&#39;</span>)
<span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">command</span>, ...<span style="color:#a6e22e">arguments</span>) =&gt; {
  <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">port</span>.<span style="color:#a6e22e">postMessage</span>({ <span style="color:#a6e22e">command</span>, <span style="color:#a6e22e">arguments</span> })
}
</code></pre></div><h4 id="zoom-1">Zoom</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;Equal&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;zoom-in&#39;</span>), <span style="color:#e6db74">&#39;Zoom in&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Minus&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;zoom-out&#39;</span>), <span style="color:#e6db74">&#39;Zoom out&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Equal&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;zoom-reset&#39;</span>), <span style="color:#e6db74">&#39;Reset to default zoom level&#39;</span>)
</code></pre></div><h4 id="create-tabs-1">Create tabs</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyT&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;new-tab&#39;</span>), <span style="color:#e6db74">&#39;New tab&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyT&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;restore-tab&#39;</span>), <span style="color:#e6db74">&#39;Restore tab&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyB&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;duplicate-tab&#39;</span>), <span style="color:#e6db74">&#39;Duplicate tab&#39;</span>)
</code></pre></div><h4 id="create-windows-1">Create windows</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyN&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;new-window&#39;</span>), <span style="color:#e6db74">&#39;New window&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyN&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;new-incognito-window&#39;</span>), <span style="color:#e6db74">&#39;New incognito window&#39;</span>)
</code></pre></div><h4 id="close-tabs-1">Close tabs</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyX&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;close-tab&#39;</span>), <span style="color:#e6db74">&#39;Close tab&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyX&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;close-other-tabs&#39;</span>), <span style="color:#e6db74">&#39;Close other tabs&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyX&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;close-right-tabs&#39;</span>), <span style="color:#e6db74">&#39;Close tabs to the right&#39;</span>)
</code></pre></div><h4 id="refresh-tabs-1">Refresh tabs</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyR&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;reload-all-tabs&#39;</span>), <span style="color:#e6db74">&#39;Reload all tabs&#39;</span>)
</code></pre></div><h4 id="switch-tabs-1">Switch tabs</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyL&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;next-tab&#39;</span>), <span style="color:#e6db74">&#39;Next tab&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyH&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;previous-tab&#39;</span>), <span style="color:#e6db74">&#39;Previous tab&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Digit1&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;first-tab&#39;</span>), <span style="color:#e6db74">&#39;First tab&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Digit0&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;last-tab&#39;</span>), <span style="color:#e6db74">&#39;Last tab&#39;</span>)
</code></pre></div><h4 id="move-tabs-1">Move tabs</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyL&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;move-tab-right&#39;</span>), <span style="color:#e6db74">&#39;Move tab right&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyH&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;move-tab-left&#39;</span>), <span style="color:#e6db74">&#39;Move tab left&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Digit1&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;move-tab-first&#39;</span>), <span style="color:#e6db74">&#39;Move tab first&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Digit0&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;move-tab-last&#39;</span>), <span style="color:#e6db74">&#39;Move tab last&#39;</span>)
</code></pre></div><h4 id="detach-tabs-1">Detach tabs</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyD&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;detach-tab&#39;</span>), <span style="color:#e6db74">&#39;Detach tab&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyD&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;attach-tab&#39;</span>), <span style="color:#e6db74">&#39;Attach tab&#39;</span>)
</code></pre></div><h4 id="discard-tabs-1">Discard tabs</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyZ&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;discard-tab&#39;</span>), <span style="color:#e6db74">&#39;Discard tab&#39;</span>)
</code></pre></div><h4 id="mute-tabs-1">Mute tabs</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyM&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;mute-tab&#39;</span>), <span style="color:#e6db74">&#39;Mute tab&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;KeyM&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;mute-all-tabs&#39;</span>), <span style="color:#e6db74">&#39;Mute all tabs&#39;</span>)
</code></pre></div><h4 id="pin-tabs-1">Pin tabs</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyP&#39;</span>], () =&gt; <span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;pin-tab&#39;</span>), <span style="color:#e6db74">&#39;Pin tab&#39;</span>)
</code></pre></div><h2 id="part-7-native-messaging-and-external-commands">Part 7: Native messaging and external commands</h2>
<p>The completed extension can be downloaded <a href="https://github.com/alexherbo2/chrome-shell">here</a>.</p>
<h3 id="introduction">Introduction</h3>
<blockquote>
<p>Extensions can exchange messages with native applications using an API that is
similar to the other <a href="https://developer.chrome.com/extensions/messaging">message passing APIs</a>.  Native applications
that support this feature must register a native messaging host that knows how to
communicate with the extension.  Chrome starts the host in a separate process and
communicates with it using standard input and standard output streams.</p>
</blockquote>
<p>Start by creating a new directory to hold the extension and application’s files.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir -p chrome-shell/extension chrome-shell/host
cd chrome-shell
</code></pre></div><h3 id="native-messaging-host">Native messaging host</h3>
<blockquote>
<p>In order to register a native messaging host the application must install a manifest
file that defines the native messaging host configuration.</p>
</blockquote>
<p><code>host/shell.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;shell&#34;</span>,
  <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Native messaging host to execute external commands&#34;</span>,
  <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/home/taupiqueur/projects/chrome-shell/host/bin/chrome-shell&#34;</span>,
  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;stdio&#34;</span>,
  <span style="color:#f92672">&#34;allowed_origins&#34;</span>: [
    <span style="color:#e6db74">&#34;chrome-extension://ohgecdnlcckpfnhjepfdcdgcfgebkdgl/&#34;</span>
  ]
}
</code></pre></div><h3 id="native-messaging-host-location">Native messaging host location</h3>
<p>The location of the manifest file depends on the <a href="https://developer.chrome.com/extensions/nativeMessaging#native-messaging-host-location">platform</a>.</p>
<p>Here are the scripts to handle the installation:</p>
<p><code>host/scripts/chrome-target.sh</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">XDG_CONFIG_HOME<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>XDG_CONFIG_HOME<span style="color:#66d9ef">:-</span>~/.config<span style="color:#e6db74">}</span>

<span style="color:#75715e"># https://developer.chrome.com/extensions/nativeMessaging#native-messaging-host-location</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">$(</span>uname -s<span style="color:#66d9ef">)</span> in
  Darwin<span style="color:#f92672">)</span>
    TARGET<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$HOME<span style="color:#e6db74">/Library/Application Support/Google/Chrome/NativeMessagingHosts&#34;</span>
    ;;
  Linux<span style="color:#f92672">)</span>
    TARGET<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$XDG_CONFIG_HOME<span style="color:#e6db74">/google-chrome/NativeMessagingHosts&#34;</span>
    ;;
<span style="color:#66d9ef">esac</span>
</code></pre></div><p><code>host/scripts/chromium-target.sh</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">XDG_CONFIG_HOME<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>XDG_CONFIG_HOME<span style="color:#66d9ef">:-</span>~/.config<span style="color:#e6db74">}</span>

<span style="color:#75715e"># https://developer.chrome.com/extensions/nativeMessaging#native-messaging-host-location</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">$(</span>uname -s<span style="color:#66d9ef">)</span> in
  Darwin<span style="color:#f92672">)</span>
    TARGET<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$HOME<span style="color:#e6db74">/Library/Application Support/Chromium/NativeMessagingHosts&#34;</span>
    ;;
  Linux<span style="color:#f92672">)</span>
    TARGET<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$XDG_CONFIG_HOME<span style="color:#e6db74">/chromium/NativeMessagingHosts&#34;</span>
    ;;
<span style="color:#66d9ef">esac</span>
</code></pre></div><p><code>host/scripts/install-manifest</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Faces</span>
none<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;\033[0m&#39;</span>
green<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;\033[32m&#39;</span>

export application<span style="color:#f92672">=</span>$PWD/bin/chrome-shell
<span style="color:#66d9ef">for</span> platform <span style="color:#66d9ef">do</span>
  . <span style="color:#e6db74">&#34;./scripts/</span>$platform<span style="color:#e6db74">-target.sh&#34;</span>
  mkdir -p <span style="color:#e6db74">&#34;</span>$TARGET<span style="color:#e6db74">&#34;</span>
  printf <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>green<span style="color:#e6db74">}</span><span style="color:#e6db74">Installing</span><span style="color:#e6db74">${</span>none<span style="color:#e6db74">}</span><span style="color:#e6db74">: %s\n&#34;</span> <span style="color:#e6db74">&#34;</span>$TARGET<span style="color:#e6db74">/shell.json&#34;</span>
  jq <span style="color:#e6db74">&#39;.path = env.application&#39;</span> shell.json &gt; <span style="color:#e6db74">&#34;</span>$TARGET<span style="color:#e6db74">/shell.json&#34;</span>
<span style="color:#66d9ef">done</span>
</code></pre></div><p><code>host/scripts/uninstall-manifest</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Faces</span>
none<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;\033[0m&#39;</span>
green<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;\033[32m&#39;</span>

<span style="color:#66d9ef">for</span> platform <span style="color:#66d9ef">do</span>
  . <span style="color:#e6db74">&#34;./scripts/</span>$platform<span style="color:#e6db74">-target.sh&#34;</span>
  printf <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>green<span style="color:#e6db74">}</span><span style="color:#e6db74">Removing</span><span style="color:#e6db74">${</span>none<span style="color:#e6db74">}</span><span style="color:#e6db74">: %s\n&#34;</span> <span style="color:#e6db74">&#34;</span>$TARGET<span style="color:#e6db74">/shell.json&#34;</span>
  rm -f <span style="color:#e6db74">&#34;</span>$TARGET<span style="color:#e6db74">/shell.json&#34;</span>
<span style="color:#66d9ef">done</span>
</code></pre></div><h3 id="native-messaging-protocol">Native messaging protocol</h3>
<blockquote>
<p>Chrome starts each native messaging host in a separate process and communicates
with it using standard input (<code>stdin</code>) and standard output (<code>stdout</code>).
The same format is used to send messages in both directions: each message is
serialized using JSON, UTF-8 encoded and is preceded with 32-bit message length
in native byte order.</p>
</blockquote>
<h3 id="meet-crystal">Meet Crystal</h3>
<p>Create a new <a href="https://crystal-lang.org">Crystal</a> project.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">crystal init app chrome-shell host
</code></pre></div><p><code>host/shard.yml</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">chrome-shell</span>
<span style="color:#f92672">version</span>: <span style="color:#ae81ff">0.1.0</span>
<span style="color:#f92672">license</span>: <span style="color:#ae81ff">Unlicense</span>
<span style="color:#f92672">targets</span>:
  <span style="color:#f92672">chrome-shell</span>:
    <span style="color:#f92672">main</span>: <span style="color:#ae81ff">src/chrome-shell.cr</span>
</code></pre></div><p>Here is the implementation to execute external commands.</p>
<p><code>host/src/chrome-shell.cr</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-crystal" data-lang="crystal"><span style="color:#66d9ef">require</span> <span style="color:#e6db74">&#34;json&#34;</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Request</span>
  <span style="color:#66d9ef">JSON</span><span style="color:#f92672">.</span>mapping({
    <span style="color:#e6db74">id</span>: String<span style="color:#e6db74">?,</span>
    <span style="color:#e6db74">command</span>: String,
    <span style="color:#e6db74">arguments</span>: Array(String)<span style="color:#e6db74">?,</span>
    <span style="color:#e6db74">environment</span>: Hash(String, String)<span style="color:#e6db74">?,</span>
    <span style="color:#e6db74">shell</span>: { <span style="color:#e6db74">type</span>: Bool, <span style="color:#e6db74">default</span>: <span style="color:#66d9ef">false</span> },
    <span style="color:#e6db74">input</span>: String<span style="color:#e6db74">?,</span>
    <span style="color:#e6db74">directory</span>: String?
  })
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>
  loop <span style="color:#66d9ef">do</span>
    request <span style="color:#f92672">=</span> read
    stdin <span style="color:#f92672">=</span> <span style="color:#66d9ef">IO</span><span style="color:#f92672">::</span>Memory<span style="color:#f92672">.</span>new
    stdout <span style="color:#f92672">=</span> <span style="color:#66d9ef">IO</span><span style="color:#f92672">::</span>Memory<span style="color:#f92672">.</span>new
    stderr <span style="color:#f92672">=</span> <span style="color:#66d9ef">IO</span><span style="color:#f92672">::</span>Memory<span style="color:#f92672">.</span>new
    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>input
      stdin <span style="color:#f92672">&lt;&lt;</span> request<span style="color:#f92672">.</span>input
      stdin<span style="color:#f92672">.</span>rewind
    <span style="color:#66d9ef">end</span>
    fork <span style="color:#66d9ef">do</span>
      status <span style="color:#f92672">=</span> Process<span style="color:#f92672">.</span>run(
        <span style="color:#e6db74">command</span>: request<span style="color:#f92672">.</span>command,
        <span style="color:#e6db74">args</span>: request<span style="color:#f92672">.</span>arguments,
        <span style="color:#e6db74">env</span>: request<span style="color:#f92672">.</span>environment,
        <span style="color:#e6db74">shell</span>: request<span style="color:#f92672">.</span>shell,
        <span style="color:#e6db74">input</span>: stdin,
        <span style="color:#e6db74">output</span>: stdout,
        <span style="color:#e6db74">error</span>: stderr,
        <span style="color:#e6db74">chdir</span>: request<span style="color:#f92672">.</span>directory
      )
      response <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">id</span>: request<span style="color:#f92672">.</span>id,
        <span style="color:#e6db74">status</span>: status<span style="color:#f92672">.</span>exit_status,
        <span style="color:#e6db74">output</span>: stdout<span style="color:#f92672">.</span>to_s,
        <span style="color:#e6db74">error</span>: stderr<span style="color:#f92672">.</span>to_s
      }
      send(response)
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

<span style="color:#75715e"># Step 1: Read the message length (first 4 bytes)</span>
<span style="color:#75715e"># Step 2: Read the text (JSON object) of the message</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read</span>
  bytes <span style="color:#f92672">=</span> <span style="color:#66d9ef">STDIN</span><span style="color:#f92672">.</span>read_bytes(Int32)
  string <span style="color:#f92672">=</span> <span style="color:#66d9ef">STDIN</span><span style="color:#f92672">.</span>read_string(bytes)
  request <span style="color:#f92672">=</span> Request<span style="color:#f92672">.</span>from_json(string)
<span style="color:#66d9ef">end</span>

<span style="color:#75715e"># Step 1: Write the message size</span>
<span style="color:#75715e"># Step 2: Write the message itself</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send</span>(response)
  string <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>to_json
  <span style="color:#66d9ef">STDOUT</span><span style="color:#f92672">.</span>write_bytes(string<span style="color:#f92672">.</span>bytesize)
  <span style="color:#66d9ef">STDOUT</span> <span style="color:#f92672">&lt;&lt;</span> string
  <span style="color:#66d9ef">STDOUT</span><span style="color:#f92672">.</span>flush
<span style="color:#66d9ef">end</span>

main
</code></pre></div><p>Put the commands in a Makefile.</p>
<p><code>host/Makefile</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile"><span style="color:#a6e22e">build</span><span style="color:#f92672">:</span>
	shards build --release

<span style="color:#a6e22e">install</span><span style="color:#f92672">:</span> build
	./scripts/install-manifest chrome chromium

<span style="color:#a6e22e">uninstall</span><span style="color:#f92672">:</span>
	./scripts/uninstall-manifest chrome chromium

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
	rm -Rf bin
</code></pre></div><p><code>host/.gitignore</code></p>
<pre><code class="language-gitignore" data-lang="gitignore">bin
</code></pre><h3 id="connecting-to-the-application">Connecting to the application</h3>
<blockquote>
<p>Sending and receiving messages to and from a native application is very similar
to <a href="https://developer.chrome.com/extensions/messaging#external">cross-extension messaging</a>.  The main difference is that <a href="https://developer.chrome.com/extensions/runtime#method-connectNative">runtime.connectNative</a>
is used instead of <a href="https://developer.chrome.com/extensions/runtime#method-connect">runtime.connect</a>, and <a href="https://developer.chrome.com/extensions/runtime#method-sendNativeMessage">runtime.sendNativeMessage</a> is used
instead of <a href="https://developer.chrome.com/extensions/runtime#method-sendMessage">runtime.sendMessage</a>.</p>
</blockquote>
<blockquote>
<p>These methods can only be used if the <code>nativeMessaging</code> permission is
<a href="https://developer.chrome.com/extensions/declare_permissions">declared</a> in your extension’s manifest file.</p>
</blockquote>
<p>Create the manifest and background script for the extension.</p>
<p><code>extension/manifest.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">Extension</span> <span style="color:#960050;background-color:#1e0010">ID:</span> <span style="color:#960050;background-color:#1e0010">ohgecdnlcckpfnhjepfdcdgcfgebkdgl</span>
  <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmSz06f+QU6YhleWBKOEUy88DV8wOmNy7Jf9mRhBqXjHVhySBbkOrPkWsMbLEHwo0MdEDf3XrrC38t95l/gvcTgSZv6VQpknf+QuMI4LWmkAqyD+M3F/w3pXXiiHNa6gQHeFganF7XckTDQzEUZFRjXlgW12wsGOnEGbjVKq8/ZXTHiMbFaACiy/ZAi3OvaJVR5KdxMkxtFg7Wg+bKY6Esi7GLeNKlBttahXAKMPcGenuLCmLzKEcIE6CSRKHu1zDlfUXn2Mmc5j5oLJDKuy2vA2yIu1CoLahgeHFUewZCFFKjMwO1ZQMUMO1yN18IterFDdkMsn5rdvC0w2tPLXYeQIDAQAB&#34;</span>,
  <span style="color:#f92672">&#34;manifest_version&#34;</span>: <span style="color:#ae81ff">2</span>,
  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Shell&#34;</span>,
  <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Chrome API to execute external commands through native messaging&#34;</span>,
  <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0.1.0&#34;</span>,
  <span style="color:#f92672">&#34;permissions&#34;</span>: [
    <span style="color:#e6db74">&#34;nativeMessaging&#34;</span>
  ],
  <span style="color:#f92672">&#34;background&#34;</span>: {
    <span style="color:#f92672">&#34;scripts&#34;</span>: [
      <span style="color:#e6db74">&#34;background.js&#34;</span>
    ],
    <span style="color:#f92672">&#34;persistent&#34;</span>: <span style="color:#66d9ef">false</span>
  },
  <span style="color:#f92672">&#34;icons&#34;</span>: {
    <span style="color:#f92672">&#34;16&#34;</span>: <span style="color:#e6db74">&#34;build/chromium.png&#34;</span>,
    <span style="color:#f92672">&#34;48&#34;</span>: <span style="color:#e6db74">&#34;build/chromium.png&#34;</span>,
    <span style="color:#f92672">&#34;128&#34;</span>: <span style="color:#e6db74">&#34;build/chromium.png&#34;</span>
  }
}
</code></pre></div><p><code>extension/background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shell</span> <span style="color:#f92672">=</span> {}
<span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">connectNative</span>(<span style="color:#e6db74">&#39;shell&#39;</span>)
<span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">onConnectExternal</span>.<span style="color:#a6e22e">addListener</span>((<span style="color:#a6e22e">port</span>) =&gt; {
  <span style="color:#75715e">// Send request to the application
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">port</span>.<span style="color:#a6e22e">onMessage</span>.<span style="color:#a6e22e">addListener</span>((<span style="color:#a6e22e">request</span>) =&gt; {
    <span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">port</span>.<span style="color:#a6e22e">postMessage</span>(<span style="color:#a6e22e">request</span>)
  })
  <span style="color:#75715e">// Receive response
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">port</span>.<span style="color:#a6e22e">onMessage</span>.<span style="color:#a6e22e">addListener</span>((<span style="color:#a6e22e">response</span>) =&gt; {
    <span style="color:#a6e22e">port</span>.<span style="color:#a6e22e">postMessage</span>(<span style="color:#a6e22e">response</span>)
  })
})
</code></pre></div><p>Create Makefile and <code>fetch</code> script.</p>
<p><code>extension/fetch</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>
fetch<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">case</span> $# in
    1<span style="color:#f92672">)</span> curl --location --remote-name $1 ;;
    2<span style="color:#f92672">)</span> curl --location $1 --output $2 ;;
  <span style="color:#66d9ef">esac</span>
<span style="color:#f92672">}</span>

mkdir -p packages
cd packages

fetch https://upload.wikimedia.org/wikipedia/commons/5/5f/Chromium_11_Logo.svg chromium.svg
</code></pre></div><p><code>extension/Makefile</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile"><span style="color:#a6e22e">build</span><span style="color:#f92672">:</span> fetch
	mkdir -p build
	inkscape --without-gui packages/chromium.svg --export-png build/chromium.png

<span style="color:#a6e22e">fetch</span><span style="color:#f92672">:</span>
	./fetch

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
	rm -Rf build packages

<span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> build fetch
</code></pre></div><p><code>extension/.gitignore</code></p>
<pre><code class="language-gitignore" data-lang="gitignore">build
packages
</code></pre><h3 id="configuration-3">Configuration</h3>
<p>Connect the configuration to the shell API:</p>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shell</span> <span style="color:#f92672">=</span> {}
<span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">connect</span>(<span style="color:#e6db74">&#39;ohgecdnlcckpfnhjepfdcdgcfgebkdgl&#39;</span>)
<span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">send</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">command</span>, ...<span style="color:#a6e22e">arguments</span>) =&gt; {
  <span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">port</span>.<span style="color:#a6e22e">postMessage</span>({ <span style="color:#a6e22e">command</span>, <span style="color:#a6e22e">arguments</span> })
}
</code></pre></div><h4 id="open-links-1">Open links</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">open</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">selections</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">links</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">includes</span>(document.<span style="color:#a6e22e">activeElement</span>)
    <span style="color:#f92672">?</span> <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">collection</span>
    <span style="color:#f92672">:</span> [document.<span style="color:#a6e22e">activeElement</span>]
  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">link</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">links</span>) {
    <span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;xdg-open&#39;</span>, <span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">href</span>)
  }
}

<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;Shift&#39;</span>, <span style="color:#e6db74">&#39;Enter&#39;</span>], () =&gt; <span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">selections</span>), <span style="color:#e6db74">&#39;Open link in the associated application&#39;</span>)
</code></pre></div><h4 id="mpv">mpv</h4>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mpv</span> <span style="color:#f92672">=</span> ({ <span style="color:#a6e22e">selections</span>, <span style="color:#a6e22e">reverse</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span> } <span style="color:#f92672">=</span> {}) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">playlist</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">includes</span>(document.<span style="color:#a6e22e">activeElement</span>)
    <span style="color:#f92672">?</span> <span style="color:#a6e22e">selections</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">link</span>) =&gt; <span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">href</span>)
    <span style="color:#f92672">:</span> [document.<span style="color:#a6e22e">activeElement</span>.<span style="color:#a6e22e">href</span>]
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">reverse</span>) {
    <span style="color:#a6e22e">playlist</span>.<span style="color:#a6e22e">reverse</span>()
  }
  <span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;mpv&#39;</span>, ...<span style="color:#a6e22e">playlist</span>)
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mpvResume</span> <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">media</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">player</span>().<span style="color:#a6e22e">media</span>
  <span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">pause</span>()
  <span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;mpv&#39;</span>, <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span>, <span style="color:#e6db74">&#39;-start&#39;</span>, <span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">currentTime</span>.<span style="color:#a6e22e">toString</span>())
}

<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Video&#39;</span>, [<span style="color:#e6db74">&#39;Enter&#39;</span>], () =&gt; <span style="color:#a6e22e">mpvResume</span>(), <span style="color:#e6db74">&#39;Play with mpv&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;KeyM&#39;</span>], () =&gt; <span style="color:#a6e22e">mpv</span>({ <span style="color:#a6e22e">selections</span> }), <span style="color:#e6db74">&#39;Play with mpv&#39;</span>)
<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Link&#39;</span>, [<span style="color:#e6db74">&#39;Alt&#39;</span>, <span style="color:#e6db74">&#39;KeyM&#39;</span>], () =&gt; <span style="color:#a6e22e">mpv</span>({ <span style="color:#a6e22e">selections</span>, <span style="color:#a6e22e">reverse</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }), <span style="color:#e6db74">&#39;Play with mpv in reverse order&#39;</span>)
</code></pre></div><h2 id="part-8-tab-search">Part 8: Tab search</h2>
<blockquote>
<p>Tab search with <a href="https://tools.suckless.org/dmenu/">dmenu</a>.</p>
</blockquote>
<p>The completed extension can be downloaded <a href="https://github.com/alexherbo2/chrome-dmenu">here</a>.</p>
<p><code>manifest.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">Extension</span> <span style="color:#960050;background-color:#1e0010">ID:</span> <span style="color:#960050;background-color:#1e0010">gonendiemfggilnopogmkafgadobkoeh</span>
  <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAhTEuT+lzy1gGMzShg7s7xadSUZdkoQh/L8c0L1hDdhDjQuB1kuCOKgExlmCAmuniea0/ZrnrnbQL154ea0HU/yWFp2ru0LmVX9ZgflVl8kQOgsb3qUz84/CkG+AyTgpqkDSuIVhb5eiAD1OW6vDCHtbda5C5/trMV3VUtItiOih4NXrUxDjw1A6ib1Fmy4DprmWJ54wI0uVrNMz7dX7+voNHwu+d7C/3EAZ7Q/8edqqHTvYXvt/5aEI85sY/z5nl1ZUVqZRlsAjuRL2j4tjDrEqcgi/pU61tzw3QvIlbwndL99/++sbrhi/sd0N2povs3JMw+tQt+sIeNMxaEZbRLQIDAQAB&#34;</span>,
  <span style="color:#f92672">&#34;manifest_version&#34;</span>: <span style="color:#ae81ff">2</span>,
  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;dmenu&#34;</span>,
  <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Tab search with dmenu&#34;</span>,
  <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0.1.0&#34;</span>,
  <span style="color:#f92672">&#34;permissions&#34;</span>: [
    <span style="color:#e6db74">&#34;tabs&#34;</span>
  ],
  <span style="color:#f92672">&#34;commands&#34;</span>: {
    <span style="color:#f92672">&#34;tab-search&#34;</span>: {
      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Tab search&#34;</span>,
      <span style="color:#f92672">&#34;suggested_key&#34;</span>: {
        <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#e6db74">&#34;Ctrl+Q&#34;</span>
      }
    }
  },
  <span style="color:#f92672">&#34;background&#34;</span>: {
    <span style="color:#f92672">&#34;scripts&#34;</span>: [
      <span style="color:#e6db74">&#34;background.js&#34;</span>
    ],
    <span style="color:#f92672">&#34;persistent&#34;</span>: <span style="color:#66d9ef">false</span>
  },
  <span style="color:#f92672">&#34;icons&#34;</span>: {
    <span style="color:#f92672">&#34;16&#34;</span>: <span style="color:#e6db74">&#34;build/suckless.png&#34;</span>,
    <span style="color:#f92672">&#34;48&#34;</span>: <span style="color:#e6db74">&#34;build/suckless.png&#34;</span>,
    <span style="color:#f92672">&#34;128&#34;</span>: <span style="color:#e6db74">&#34;build/suckless.png&#34;</span>
  }
}
</code></pre></div><p>See <a href="https://developer.chrome.com/extensions/commands">chrome.commands</a> for more information.</p>
<p><code>fetch</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">fetch https://suckless.org/logo.svg suckless.svg
</code></pre></div><p><code>background.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Extensions ──────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Shell
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shell</span> <span style="color:#f92672">=</span> {}
<span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">connect</span>(<span style="color:#e6db74">&#39;ohgecdnlcckpfnhjepfdcdgcfgebkdgl&#39;</span>)

<span style="color:#75715e">// Requests ────────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requests</span> <span style="color:#f92672">=</span> {}

<span style="color:#a6e22e">requests</span>[<span style="color:#e6db74">&#39;tab-search&#39;</span>] <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">query</span>({}, (<span style="color:#a6e22e">tabs</span>) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">input</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">tab</span>) =&gt; <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">title</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)
    <span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">port</span>.<span style="color:#a6e22e">postMessage</span>({
      <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;tab-search&#39;</span>,
      <span style="color:#a6e22e">command</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;rofi&#39;</span>,
      <span style="color:#a6e22e">arguments</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;-dmenu&#39;</span>, <span style="color:#e6db74">&#39;-i&#39;</span>, <span style="color:#e6db74">&#39;-p&#39;</span>, <span style="color:#e6db74">&#39;Tab search&#39;</span>],
      <span style="color:#a6e22e">input</span>
    })
  })
}

<span style="color:#75715e">// Responses ───────────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">responses</span> <span style="color:#f92672">=</span> {}

<span style="color:#a6e22e">responses</span>[<span style="color:#e6db74">&#39;tab-search&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#a6e22e">response</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> parseInt(<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">output</span>)
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">id</span>) {
    <span style="color:#75715e">// Does not affect whether the window is focused
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">id</span>, { <span style="color:#a6e22e">active</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> })
    <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">id</span>, (<span style="color:#a6e22e">tab</span>) =&gt; {
      <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">windows</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">windowId</span>, { <span style="color:#a6e22e">focused</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> })
    })
  }
}

<span style="color:#75715e">// Initialization ──────────────────────────────────────────────────────────────
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Commands
</span><span style="color:#75715e"></span><span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">commands</span>.<span style="color:#a6e22e">onCommand</span>.<span style="color:#a6e22e">addListener</span>((<span style="color:#a6e22e">commandRequest</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">command</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">requests</span>[<span style="color:#a6e22e">commandRequest</span>]
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">command</span>) {
    <span style="color:#a6e22e">command</span>()
  }
})

<span style="color:#75715e">// Requests
</span><span style="color:#75715e"></span><span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">onConnectExternal</span>.<span style="color:#a6e22e">addListener</span>((<span style="color:#a6e22e">port</span>) =&gt; {
  <span style="color:#a6e22e">port</span>.<span style="color:#a6e22e">onMessage</span>.<span style="color:#a6e22e">addListener</span>((<span style="color:#a6e22e">request</span>) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">command</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">requests</span>[<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">command</span>]
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arguments</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">arguments</span> <span style="color:#f92672">||</span> []
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">command</span>) {
      <span style="color:#a6e22e">command</span>(...<span style="color:#a6e22e">arguments</span>)
    }
  })
})

<span style="color:#75715e">// Responses
</span><span style="color:#75715e"></span><span style="color:#a6e22e">shell</span>.<span style="color:#a6e22e">port</span>.<span style="color:#a6e22e">onMessage</span>.<span style="color:#a6e22e">addListener</span>((<span style="color:#a6e22e">response</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">command</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">responses</span>[<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">id</span>]
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">command</span>) {
    <span style="color:#a6e22e">command</span>(<span style="color:#a6e22e">response</span>)
  }
})
</code></pre></div><p>Update your configuration.</p>
<p><code>config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dmenu</span> <span style="color:#f92672">=</span> {}
<span style="color:#a6e22e">dmenu</span>.<span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">chrome</span>.<span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">connect</span>(<span style="color:#e6db74">&#39;gonendiemfggilnopogmkafgadobkoeh&#39;</span>)
<span style="color:#a6e22e">dmenu</span>.<span style="color:#a6e22e">send</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">command</span>, ...<span style="color:#a6e22e">arguments</span>) =&gt; {
  <span style="color:#a6e22e">dmenu</span>.<span style="color:#a6e22e">port</span>.<span style="color:#a6e22e">postMessage</span>({ <span style="color:#a6e22e">command</span>, <span style="color:#a6e22e">arguments</span> })
}

<span style="color:#a6e22e">modal</span>.<span style="color:#a6e22e">map</span>(<span style="color:#e6db74">&#39;Command&#39;</span>, [<span style="color:#e6db74">&#39;KeyQ&#39;</span>], () =&gt; <span style="color:#a6e22e">dmenu</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;tab-search&#39;</span>), <span style="color:#e6db74">&#39;Tab search with dmenu&#39;</span>)
</code></pre></div><h2 id="part-9-publish-your-extension">Part 9: Publish your extension</h2>
<p><a href="https://developer.chrome.com/webstore/publish">Publish in the Chrome Web Store</a></p>
<p>Update your Makefile.</p>
<p><code>Makefile</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile"><span style="color:#a6e22e">package</span><span style="color:#f92672">:</span> clean build
	zip --recurse-paths package.zip manifest.json config.js build packages

<span style="color:#a6e22e">chrome-web-store</span><span style="color:#f92672">:</span> build
	mkdir -p build/chrome-web-store
	inkscape --without-gui packages/chrome.svg --export-png build/chrome-web-store/icon.png --export-width <span style="color:#ae81ff">128</span> --export-height <span style="color:#ae81ff">128</span>
	inkscape --without-gui packages/chrome.svg --export-png build/chrome-web-store/screenshot.png --export-width <span style="color:#ae81ff">1280</span> --export-height <span style="color:#ae81ff">800</span>

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
	rm -Rf build packages package.zip
</code></pre></div><p><code>.gitignore</code></p>
<pre><code class="language-gitignore" data-lang="gitignore">build
packages
package.zip
</code></pre><h2 id="bonus">Bonus</h2>
<h3 id="unfocus-omnibox">Unfocus Omnibox</h3>
<p>Open the <em>Search engines</em> page by navigating to <code>chrome://settings/searchEngines</code>, then add a new search engine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">Search engine</span>: <span style="color:#e6db74">&#39;Unfocus Omnibox&#39;</span>
<span style="color:#f92672">Keyword</span>: <span style="color:#e6db74">&#39;j&#39;</span>
<span style="color:#f92672">URL</span>: <span style="color:#e6db74">&#39;javascript:&#39;</span>
</code></pre></div><p>See also <a href="https://superuser.com/questions/726447/keyboard-shortcut-to-deselect-omnibox-in-chrome">Keyboard shortcut to deselect omnibox in Chrome</a>.</p>
<h3 id="create-a-theme-for-chrome">Create a theme for Chrome</h3>
<p>The completed theme can be downloaded <a href="https://github.com/alexherbo2/chrome-theme">here</a>.</p>


    </main>
    <hr class="bottom">
    <footer>
  <ul class="social">
    
      <li>
        <a href="https://github.com/alexherbo2">GitHub</a>
      </li>
    
      <li>
        <a href="https://instagram.com/alexherbo2">Instagram</a>
      </li>
    
      <li>
        <a href="https://youtube.com/channel/UCv9nzkds34PnGOu6u_QvVBQ">YouTube</a>
      </li>
    
  </ul>
  <ul class="credits">
    
      <li>
        Hosted on <a href="https://github.com/alexherbo2/website">GitHub</a>
      </li>
    
    <li>
      Powered by <a href="https://gohugo.io">Hugo</a>
    </li>
    <li>
      Theme from <a href="http://stevelosh.com">Steve Losh</a>
    </li>
  </ul>
</footer>

  </body>
</html>
